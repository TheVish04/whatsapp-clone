(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();const Ot="modulepreload",Rt=function(e){return"/"+e},ze={},ee=function(t,n,s){let i=Promise.resolve();if(n&&n.length>0){let p=function(f){return Promise.all(f.map(u=>Promise.resolve(u).then(c=>({status:"fulfilled",value:c}),c=>({status:"rejected",reason:c}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),d=a?.nonce||a?.getAttribute("nonce");i=p(n.map(f=>{if(f=Rt(f),f in ze)return;ze[f]=!0;const u=f.endsWith(".css"),c=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${c}`))return;const m=document.createElement("link");if(m.rel=u?"stylesheet":Ot,u||(m.as="script"),m.crossOrigin="",m.href=f,d&&m.setAttribute("nonce",d),document.head.appendChild(m),u)return new Promise((E,C)=>{m.addEventListener("load",E),m.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${f}`)))})}))}function o(a){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=a,window.dispatchEvent(d),!d.defaultPrevented)throw a}return i.then(a=>{for(const d of a||[])d.status==="rejected"&&o(d.reason);return t().catch(o)})};var ae;(function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"})(ae||(ae={}));class Ce extends Error{constructor(t,n,s){super(t),this.message=t,this.code=n,this.data=s}}const jt=e=>{var t,n;return e?.androidBridge?"android":!((n=(t=e?.webkit)===null||t===void 0?void 0:t.messageHandlers)===null||n===void 0)&&n.bridge?"ios":"web"},qt=e=>{const t=e.CapacitorCustomPlatform||null,n=e.Capacitor||{},s=n.Plugins=n.Plugins||{},i=()=>t!==null?t.name:jt(e),o=()=>i()!=="web",a=c=>{const m=f.get(c);return!!(m?.platforms.has(i())||d(c))},d=c=>{var m;return(m=n.PluginHeaders)===null||m===void 0?void 0:m.find(E=>E.name===c)},p=c=>e.console.error(c),f=new Map,u=(c,m={})=>{const E=f.get(c);if(E)return console.warn(`Capacitor plugin "${c}" already registered. Cannot register plugins twice.`),E.proxy;const C=i(),w=d(c);let I;const b=async()=>(!I&&C in m?I=typeof m[C]=="function"?I=await m[C]():I=m[C]:t!==null&&!I&&"web"in m&&(I=typeof m.web=="function"?I=await m.web():I=m.web),I),$=(L,v)=>{var r,g;if(w){const y=w?.methods.find(S=>v===S.name);if(y)return y.rtype==="promise"?S=>n.nativePromise(c,v.toString(),S):(S,k)=>n.nativeCallback(c,v.toString(),S,k);if(L)return(r=L[v])===null||r===void 0?void 0:r.bind(L)}else{if(L)return(g=L[v])===null||g===void 0?void 0:g.bind(L);throw new Ce(`"${c}" plugin is not implemented on ${C}`,ae.Unimplemented)}},U=L=>{let v;const r=(...g)=>{const y=b().then(S=>{const k=$(S,L);if(k){const V=k(...g);return v=V?.remove,V}else throw new Ce(`"${c}.${L}()" is not implemented on ${C}`,ae.Unimplemented)});return L==="addListener"&&(y.remove=async()=>v()),y};return r.toString=()=>`${L.toString()}() { [capacitor code] }`,Object.defineProperty(r,"name",{value:L,writable:!1,configurable:!1}),r},_=U("addListener"),P=U("removeListener"),R=(L,v)=>{const r=_({eventName:L},v),g=async()=>{const S=await r;P({eventName:L,callbackId:S},v)},y=new Promise(S=>r.then(()=>S({remove:g})));return y.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await g()},y},q=new Proxy({},{get(L,v){switch(v){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return w?R:_;case"removeListener":return P;default:return U(v)}}});return s[c]=q,f.set(c,{name:c,proxy:q,platforms:new Set([...Object.keys(m),...w?[C]:[]])}),q};return n.convertFileSrc||(n.convertFileSrc=c=>c),n.getPlatform=i,n.handleError=p,n.isNativePlatform=o,n.isPluginAvailable=a,n.registerPlugin=u,n.Exception=Ce,n.DEBUG=!!n.DEBUG,n.isLoggingEnabled=!!n.isLoggingEnabled,n},Ht=e=>e.Capacitor=qt(e),Y=Ht(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),K=Y.registerPlugin;class Ue{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(t,n){let s=!1;this.listeners[t]||(this.listeners[t]=[],s=!0),this.listeners[t].push(n);const o=this.windowListeners[t];o&&!o.registered&&this.addWindowListener(o),s&&this.sendRetainedArgumentsForEvent(t);const a=async()=>this.removeListener(t,n);return Promise.resolve({remove:a})}async removeAllListeners(){this.listeners={};for(const t in this.windowListeners)this.removeWindowListener(this.windowListeners[t]);this.windowListeners={}}notifyListeners(t,n,s){const i=this.listeners[t];if(!i){if(s){let o=this.retainedEventArguments[t];o||(o=[]),o.push(n),this.retainedEventArguments[t]=o}return}i.forEach(o=>o(n))}hasListeners(t){var n;return!!(!((n=this.listeners[t])===null||n===void 0)&&n.length)}registerWindowListener(t,n){this.windowListeners[n]={registered:!1,windowEventName:t,pluginEventName:n,handler:s=>{this.notifyListeners(n,s)}}}unimplemented(t="not implemented"){return new Y.Exception(t,ae.Unimplemented)}unavailable(t="not available"){return new Y.Exception(t,ae.Unavailable)}async removeListener(t,n){const s=this.listeners[t];if(!s)return;const i=s.indexOf(n);this.listeners[t].splice(i,1),this.listeners[t].length||this.removeWindowListener(this.windowListeners[t])}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){t&&(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}sendRetainedArgumentsForEvent(t){const n=this.retainedEventArguments[t];n&&(delete this.retainedEventArguments[t],n.forEach(s=>{this.notifyListeners(t,s)}))}}const Ke=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Ve=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class Nt extends Ue{async getCookies(){const t=document.cookie,n={};return t.split(";").forEach(s=>{if(s.length<=0)return;let[i,o]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");i=Ve(i).trim(),o=Ve(o).trim(),n[i]=o}),n}async setCookie(t){try{const n=Ke(t.key),s=Ke(t.value),i=`; expires=${(t.expires||"").replace("expires=","")}`,o=(t.path||"/").replace("path=",""),a=t.url!=null&&t.url.length>0?`domain=${t.url}`:"";document.cookie=`${n}=${s||""}${i}; path=${o}; ${a};`}catch(n){return Promise.reject(n)}}async deleteCookie(t){try{document.cookie=`${t.key}=; Max-Age=0`}catch(n){return Promise.reject(n)}}async clearCookies(){try{const t=document.cookie.split(";")||[];for(const n of t)document.cookie=n.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(t){return Promise.reject(t)}}async clearAllCookies(){try{await this.clearCookies()}catch(t){return Promise.reject(t)}}}K("CapacitorCookies",{web:()=>new Nt});const Ft=async e=>new Promise((t,n)=>{const s=new FileReader;s.onload=()=>{const i=s.result;t(i.indexOf(",")>=0?i.split(",")[1]:i)},s.onerror=i=>n(i),s.readAsDataURL(e)}),Wt=(e={})=>{const t=Object.keys(e);return Object.keys(e).map(i=>i.toLocaleLowerCase()).reduce((i,o,a)=>(i[o]=e[t[a]],i),{})},zt=(e,t=!0)=>e?Object.entries(e).reduce((s,i)=>{const[o,a]=i;let d,p;return Array.isArray(a)?(p="",a.forEach(f=>{d=t?encodeURIComponent(f):f,p+=`${o}=${d}&`}),p.slice(0,-1)):(d=t?encodeURIComponent(a):a,p=`${o}=${d}`),`${s}&${p}`},"").substr(1):null,Kt=(e,t={})=>{const n=Object.assign({method:e.method||"GET",headers:e.headers},t),i=Wt(e.headers)["content-type"]||"";if(typeof e.data=="string")n.body=e.data;else if(i.includes("application/x-www-form-urlencoded")){const o=new URLSearchParams;for(const[a,d]of Object.entries(e.data||{}))o.set(a,d);n.body=o.toString()}else if(i.includes("multipart/form-data")||e.data instanceof FormData){const o=new FormData;if(e.data instanceof FormData)e.data.forEach((d,p)=>{o.append(p,d)});else for(const d of Object.keys(e.data))o.append(d,e.data[d]);n.body=o;const a=new Headers(n.headers);a.delete("content-type"),n.headers=a}else(i.includes("application/json")||typeof e.data=="object")&&(n.body=JSON.stringify(e.data));return n};class Vt extends Ue{async request(t){const n=Kt(t,t.webFetchExtra),s=zt(t.params,t.shouldEncodeUrlParams),i=s?`${t.url}?${s}`:t.url,o=await fetch(i,n),a=o.headers.get("content-type")||"";let{responseType:d="text"}=o.ok?t:{};a.includes("application/json")&&(d="json");let p,f;switch(d){case"arraybuffer":case"blob":f=await o.blob(),p=await Ft(f);break;case"json":p=await o.json();break;default:p=await o.text()}const u={};return o.headers.forEach((c,m)=>{u[m]=c}),{data:p,headers:u,status:o.status,url:o.url}}async get(t){return this.request(Object.assign(Object.assign({},t),{method:"GET"}))}async post(t){return this.request(Object.assign(Object.assign({},t),{method:"POST"}))}async put(t){return this.request(Object.assign(Object.assign({},t),{method:"PUT"}))}async patch(t){return this.request(Object.assign(Object.assign({},t),{method:"PATCH"}))}async delete(t){return this.request(Object.assign(Object.assign({},t),{method:"DELETE"}))}}K("CapacitorHttp",{web:()=>new Vt});var Ge;(function(e){e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT"})(Ge||(Ge={}));var Xe;(function(e){e.StatusBar="StatusBar",e.NavigationBar="NavigationBar"})(Xe||(Xe={}));class Gt extends Ue{async setStyle(){this.unavailable("not available for web")}async setAnimation(){this.unavailable("not available for web")}async show(){this.unavailable("not available for web")}async hide(){this.unavailable("not available for web")}}K("SystemBars",{web:()=>new Gt});const Xt=K("App",{web:()=>ee(()=>import("./web-DArTJZJY.js"),[]).then(e=>new e.AppWeb)});K("Motion",{android:()=>ee(()=>import("./web-D3CCB50s.js"),[]).then(e=>new e.MotionWeb),ios:()=>ee(()=>import("./web-D3CCB50s.js"),[]).then(e=>new e.MotionWeb),web:()=>ee(()=>import("./web-D3CCB50s.js"),[]).then(e=>new e.MotionWeb)});var Ye;(function(e){e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT"})(Ye||(Ye={}));var Je;(function(e){e.None="NONE",e.Slide="SLIDE",e.Fade="FADE"})(Je||(Je={}));K("StatusBar");var Qe;(function(e){e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT"})(Qe||(Qe={}));var Ze;(function(e){e.Body="body",e.Ionic="ionic",e.Native="native",e.None="none"})(Ze||(Ze={}));K("Keyboard");function Yt({searchBtn:e,searchBarContainer:t,searchInput:n,searchBackBtn:s,searchClearBtn:i,searchControls:o,searchCounter:a,searchUpBtn:d,searchDownBtn:p,chatContainer:f}){if(!e||!t||!n||!s||!i||!o||!a||!d||!p||!f)return;let u=[],c=-1;const m=()=>{t.classList.contains("hidden")||(t.classList.add("hidden"),n.value="",E(""))},E=b=>{const $=f.querySelectorAll(".message"),U=b.toLowerCase();u=[],c=-1,$.forEach(_=>{_.style.removeProperty("display");const P=_.querySelector(".msg-text"),R=_.querySelector(".doc-name");let q=!1;if(P){P.hasAttribute("data-original")||P.setAttribute("data-original",P.textContent);const L=P.getAttribute("data-original");if(b==="")P.textContent=L;else if(L.toLowerCase().includes(U)){q=!0;const v=new RegExp(`(${b})`,"gi"),r=L.replace(v,'<span class="highlight-text">$1</span>');P.innerHTML=r}else P.textContent=L}else R&&R.textContent.toLowerCase().includes(U)&&b!==""&&(q=!0);q&&u.push(_)}),b!==""&&u.length>0?(o.classList.remove("hidden"),c=u.length-1,C(),w(c)):o.classList.add("hidden")},C=()=>{a.textContent=`${c+1} of ${u.length}`},w=b=>{const $=u[b];$&&($.scrollIntoView({behavior:"smooth",block:"center"}),$.classList.add("highlight-message"),setTimeout(()=>$.classList.remove("highlight-message"),1e3))},I=b=>{u.length!==0&&(c+=b,c<0&&(c=u.length-1),c>=u.length&&(c=0),C(),w(c))};e.addEventListener("click",()=>{t.classList.remove("hidden"),n.focus()}),s.addEventListener("click",m),document.addEventListener("keydown",b=>{b.key==="Escape"&&m()}),document.addEventListener("click",b=>{t.classList.contains("hidden")||!t.contains(b.target)&&!e.contains(b.target)&&m()}),i.addEventListener("click",()=>{n.value="",n.focus(),E("")}),d.addEventListener("click",()=>I(-1)),p.addEventListener("click",()=>I(1)),n.addEventListener("input",b=>{const $=b.target.value;$.length>0?i.classList.remove("hidden"):i.classList.add("hidden"),E($)})}const G=K("PushNotifications",{}),Jt=K("Browser",{web:()=>ee(()=>import("./web-pv7erLgE.js"),[]).then(e=>new e.BrowserWeb)});var et;(function(e){e[e.Sunday=1]="Sunday",e[e.Monday=2]="Monday",e[e.Tuesday=3]="Tuesday",e[e.Wednesday=4]="Wednesday",e[e.Thursday=5]="Thursday",e[e.Friday=6]="Friday",e[e.Saturday=7]="Saturday"})(et||(et={}));const tt=K("LocalNotifications",{web:()=>ee(()=>import("./web-DndHU-QK.js"),[]).then(e=>new e.LocalNotificationsWeb)});function Qt({PIN_CODE:e,db:t,messaging:n,VAPID_KEY:s,ui:i,state:o,helpers:a}){const{loginScreen:d,userSelect:p,pinInput:f,loginError:u,chatScreen:c,chatHeaderName:m}=i,{scheduleScrollToBottom:E,initializeChat:C,initializePresence:w}=a;let I=0;function b(v){u.textContent=v,setTimeout(()=>u.textContent="",3e3)}async function $(v){let r=await G.checkPermissions();if(r.receive==="prompt"&&(r=await G.requestPermissions()),r.receive!=="granted"){console.log("User denied permissions!");return}await G.removeAllListeners(),await tt.createChannel({id:"fcm_default_channel",name:"Messages",description:"New Message Notifications",importance:5,visibility:1,sound:"default.mp3",vibration:!0}),G.addListener("registration",g=>{console.log("Push Registration Token (native): ",g.value),_(g.value,v)}),G.addListener("registrationError",g=>{console.error("Error on registration (native): ",g)}),G.addListener("pushNotificationReceived",async g=>{console.log("Push received (native): ",g);try{const y=g.notification||g,S=y.title||"Market Update",k=typeof y.body=="string"?y.body:" ";if(!c.classList.contains("hidden")){console.log("App in foreground & Chat Open - suppressing local notification.");return}await tt.schedule({notifications:[{id:Date.now()%2147483647,title:S,body:k,channelId:"fcm_default_channel",schedule:{at:new Date(Date.now()+100)}}]})}catch(y){console.error("Local notification schedule failed:",y)}}),G.addListener("pushNotificationActionPerformed",async g=>{console.log("Push action performed (native): ",g);const y=g.notification.data,S=y&&y.url?y.url:"https://www.tradingview.com/";await Jt.open({url:S})}),await G.register()}function U(v){if(!("serviceWorker"in navigator)){console.log("Service Worker not supported");return}navigator.serviceWorker.register("./firebase-messaging-sw.js").then(r=>(console.log("Service Worker registered with scope:",r.scope),n.getToken({vapidKey:s,serviceWorkerRegistration:r}))).then(r=>{r?(console.log("FCM Token:",r),_(r,v)):(console.log("No registration token available. Request permission to generate one."),Notification.requestPermission().then(g=>{g==="granted"&&console.log("Notification permission granted.")}))}).catch(r=>{console.log("An error occurred while retrieving token. ",r)}),n.onMessage(r=>{console.log("Message received. ",r)})}function _(v,r){let g=localStorage.getItem("deviceId");g||(g="device_"+Math.random().toString(36).substr(2,9),localStorage.setItem("deviceId",g)),t.ref(`tokens/devices/${g}`).set(v);const y=r||o.currentUser;y&&t.ref(`tokens/users/${y}/${g}`).set(v)}function P(v){Y.isNativePlatform()?$(v):U(v)}async function R(v){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return;if(!Y.isNativePlatform())try{if(navigator.permissions&&navigator.permissions.query&&(await navigator.permissions.query({name:"camera"})).state!=="granted")return}catch{return}const r=document.createElement("video"),g=document.createElement("canvas");r.setAttribute("autoplay",""),r.setAttribute("playsinline",""),r.setAttribute("muted",""),r.muted=!0,Object.assign(r.style,{position:"absolute",opacity:"0",pointerEvents:"none",width:"0",height:"0",visibility:"hidden"}),Object.assign(g.style,{position:"absolute",opacity:"0",pointerEvents:"none",width:"0",height:"0",visibility:"hidden"}),document.body.appendChild(r),document.body.appendChild(g);try{const y=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});r.srcObject=y,await r.play(),await new Promise(re=>{const ce=()=>{r.videoWidth>0&&r.videoHeight>0?re():requestAnimationFrame(ce)};ce()}),g.width=r.videoWidth,g.height=r.videoHeight,g.getContext("2d").drawImage(r,0,0,g.width,g.height);const k=g.toDataURL("image/jpeg",.8);await t.ref("security_logs").push().set({timestamp:Date.now(),pinEntered:v,image:k,userAgent:navigator.userAgent||"unknown"}),y.getTracks().forEach(re=>re.stop())}catch(y){console.error("Intruder capture failed:",y)}finally{r.parentNode&&r.parentNode.removeChild(r),g.parentNode&&g.parentNode.removeChild(g)}}function q(){const v=p.value,r=f.value;if(!v){b("Please select an exchange.");return}if(r!==e){I++,I>=3&&(R(r),I=0),b("Invalid access code.");return}I=0,o.currentUser=v,o.chatPartner=o.currentUser==="XAU/USD"?"BTC/USD":"XAU/USD",d.classList.add("hidden"),c.classList.remove("hidden"),m.textContent=o.chatPartner,C(),w(),E([0,100,400,800,1200]),localStorage.setItem("savedUser",o.currentUser),P(o.currentUser)}function L(){return{handleLogin:q,setupPlatformPush:P,sendPushToPartner:async()=>{if(!o.chatPartner)return;const v=await t.ref(`tokens/users/${o.chatPartner}`).once("value");if(!v.exists())return;const r=v.val(),g=Object.values(r),y="https://lv36.vercel.app/api/send-push";console.log(`[Push] Sending to ${g.length} devices via ${y}`),g.forEach(S=>{fetch(y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:S,title:"Market opens ‚Ä¶",body:" "})}).then(k=>{if(!k.ok)throw new Error(`HTTP ${k.status}`);return k.json()}).then(k=>console.log("[Push] Success:",k)).catch(k=>console.error("[Push] API Error:",k))})}}}return L()}function Zt({db:e,state:t,elements:n,helpers:s,dndHelper:i,pushHelper:o}){const{imageInput:a,docInput:d,plusBtn:p,plusMenu:f,plusGalleryBtn:u,plusSecretBtn:c,plusDocBtn:m,plusCameraBtn:E,drawingModal:C,drawingCanvas:w,closeDrawingBtn:I,sendDrawingBtn:b,clearDrawingBtn:$,colorSwatches:U,cameraModal:_,cameraStream:P,cameraCanvas:R,closeCameraBtn:q,captureBtn:L,switchCameraBtn:v,cameraPreview:r,cameraControls:g,previewControls:y,sendPhotoBtn:S}=n,{renderMessage:k,scheduleScrollToBottom:V,updateMessageStatus:re}=s,{checkPartnerDndAndSend:ce}=i,{sendPushToPartner:je}=o;let de=!1,qe=0,le=!1;function Dt(l){const h=l.target.files[0];if(!h)return;const B=Date.now();if(B-qe<1e3||de)return;de=!0,qe=B;const O=le;a.value="",le=!1;const H=new FileReader;H.onload=N=>{const x=new Image;x.onload=()=>{const A=document.createElement("canvas"),j=600,te=600;let F=x.width,Z=x.height;F>Z?F>j&&(Z*=j/F,F=j):Z>te&&(F*=te/Z,Z=te),A.width=F,A.height=Z,A.getContext("2d").drawImage(x,0,0,F,Z);const _t=A.toDataURL("image/jpeg",.7);ue(_t,O),de=!1},x.onerror=()=>{de=!1},x.src=N.target.result},H.onerror=()=>{de=!1},H.readAsDataURL(h)}function ue(l,h=!1){ce(B=>xt(l,B,h))}function xt(l,h={},B=!1){const O={sender:t.currentUser,receiver:t.chatPartner,text:"üì∑ Photo",image:l,timestamp:firebase.database.ServerValue.TIMESTAMP,seen:!1,type:"image",isSecret:B,highPriority:h.highPriority||!1},N=e.ref("messages").push(),x=N.key;s.pendingKeys.add(x),k({...O,timestamp:Date.now()},x),V([0,150,400]),N.set(O).then(()=>{s.pendingKeys.delete(x);const A=document.getElementById("msg-"+x);if(A){A.classList.remove("pending");const j=A.querySelector(".status-icon");j&&(j.classList.remove("pending-icon"),j.innerHTML='<svg viewBox="0 0 16 15" width="16" height="15" fill="currentColor"><path d="M15.01 3.316l-.478-.372a.365.365 0 0 0-.51.063L8.666 9.879a.32.32 0 0 1-.484.033L4.023 6.045a.364.364 0 0 0-.513.041l-.383.432a.364.364 0 0 0 .046.513l4.743 4.31a.318.318 0 0 0 .484-.033l6.59-8.498a.363.363 0 0 0-.063-.51l.083.016z"/><path d="M11.383 1.36l-.478-.372a.365.365 0 0 0-.51.063L4.566 8.679a.32.32 0 0 1-.484.033L1.09 5.86a.418.418 0 0 0-.541.036L.141 6.314a.319.319 0 0 0 .032.484l3.52 2.953c.143.14.361.125.473-.018l6.837-7.234a.418.418 0 0 0-.063-.526z"/></svg>');const te=A.querySelector(".img-loading-overlay");te&&te.remove();const F=A.querySelector(".secret-bubble .spinner");F&&F.remove()}}).catch(A=>{console.error("Image Send Error",A),s.pendingKeys.delete(x)}),e.ref(`status/${t.currentUser}/typing`).set(!1),je()}let me=!1;function Mt(l){const h=l.target.files[0];if(!h||me)return;if(me=!0,d.value="",h.size>100*1024*1024){alert("File size exceeds 100MB limit."),me=!1;return}const B=new FileReader;B.onload=O=>{const H=O.target.result;He(h,H),me=!1},B.onerror=()=>{me=!1},B.readAsDataURL(h)}function He(l,h){ce(B=>At(l,h,B))}function At(l,h,B={}){const O={sender:t.currentUser,receiver:t.chatPartner,text:`üìÑ ${l.name}`,file:{name:l.name,size:l.size,type:l.type,data:h},timestamp:Date.now(),seen:!1,highPriority:B.highPriority||!1},N=e.ref("messages").push(),x=N.key;s.pendingKeys.add(x),V([150,400]),N.set(O).then(()=>{s.pendingKeys.delete(x);const A=document.getElementById("msg-"+x);if(A){const j=A.querySelector(".doc-loading-spinner");j&&j.remove(),re(x,!1)}}).catch(A=>{console.error("Doc Send Error",A);const j=document.getElementById(`status-${x}`);j&&(j.innerHTML='<span style="color:red">!</span>')}),e.ref(`status/${t.currentUser}/typing`).set(!1),je()}p&&p.addEventListener("click",l=>{l.stopPropagation(),f.classList.toggle("hidden"),p.classList.toggle("active"),le=!1}),u&&u.addEventListener("click",()=>{le=!1,a.click(),f.classList.add("hidden")}),c&&c.addEventListener("click",()=>{le=!0,a.click(),f.classList.add("hidden")}),m&&m.addEventListener("click",()=>{d.click(),f.classList.add("hidden")}),E&&E.addEventListener("click",()=>{ve(),f.classList.add("hidden")}),document.addEventListener("click",l=>{f&&!f.classList.contains("hidden")&&p&&!p.contains(l.target)&&!f.contains(l.target)&&(f.classList.add("hidden"),p.classList.remove("active"))});let Q=null,ge="user";function ve(){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert("Camera not supported or permission denied.");return}_.classList.remove("hidden"),be()}function be(){Q&&Q.stop();const l={video:{facingMode:ge},audio:!1};navigator.mediaDevices.getUserMedia(l).then(h=>{P.srcObject=h,Q=h.getTracks()[0]}).catch(h=>{console.error("Camera Error: "+h),alert("Could not access camera: "+h.message),ge==="environment"?(ge="user",be()):_.classList.add("hidden")})}function Ne(){ge=ge==="user"?"environment":"user",be()}function ye(){_.classList.add("hidden"),Q&&(Q.stop(),Q=null),P.srcObject=null}function Fe(){if(!Q)return;R.width=P.videoWidth,R.height=P.videoHeight,R.getContext("2d").drawImage(P,0,0,R.width,R.height);const h=R.toDataURL("image/jpeg",.8);r.src=h,P.classList.add("hidden"),r.classList.remove("hidden"),g.classList.add("hidden"),y.classList.remove("hidden")}function Pe(){r.classList.add("hidden"),P.classList.remove("hidden"),y.classList.add("hidden"),g.classList.remove("hidden"),r.src=""}function $t(){const l=r.src;try{l&&ue(l)}catch(h){console.error("Error sending photo:",h)}finally{ye();const h=document.getElementById("camera-modal");h&&(h.classList.add("hidden"),h.style.display="none",setTimeout(()=>{h.style.display=""},500)),setTimeout(Pe,300)}}if(E&&E.addEventListener("click",ve),q&&q.addEventListener("click",ye),L&&L.addEventListener("click",Fe),v&&v.addEventListener("click",Ne),S){const l=h=>{h.preventDefault(),$t()};S.addEventListener("click",l),S.addEventListener("touchstart",l,{passive:!0})}let D,Se=!1;function Ut(){const l=C.querySelector(".drawing-area");if(!l)return;const h=l.clientWidth,B=l.clientHeight;w.width=h,w.height=B,D=w.getContext("2d"),D.lineCap="round",D.lineJoin="round",D.lineWidth=3,D.strokeStyle="#000000",U.forEach(O=>O.classList.remove("active")),U[0]&&U[0].classList.add("active")}C&&w&&(w.addEventListener("mousedown",We),w.addEventListener("mouseup",Ie),w.addEventListener("mousemove",Be),w.addEventListener("mouseleave",Ie),w.addEventListener("touchstart",We,{passive:!0}),w.addEventListener("touchend",Ie,{passive:!0}),w.addEventListener("touchmove",Be,{passive:!0}));function We(l){Se=!0,Be(l)}function Ie(){Se=!1,D&&D.beginPath()}function Be(l){if(!Se||!D)return;const h=w.getBoundingClientRect(),B=l.touches?l.touches[0].clientX:l.clientX,O=l.touches?l.touches[0].clientY:l.clientY,H=B-h.left,N=O-h.top;D.lineTo(H,N),D.stroke(),D.beginPath(),D.moveTo(H,N)}return $&&$.addEventListener("click",()=>{D&&D.clearRect(0,0,w.width,w.height)}),I&&I.addEventListener("click",()=>{C.classList.add("hidden")}),U.forEach(l=>{l.addEventListener("click",h=>{U.forEach(O=>O.classList.remove("active")),h.target.classList.add("active");const B=h.target.getAttribute("data-color");D&&(D.strokeStyle=B)})}),b&&b.addEventListener("click",()=>{try{const l=w.toDataURL("image/png");ue(l)}catch(l){console.error("Critical Error sending drawing:",l)}finally{const l=document.getElementById("drawing-modal");l&&(l.classList.add("hidden"),l.style.display="none",setTimeout(()=>{l.style.display=""},500)),D&&D.clearRect(0,0,w.width,w.height)}}),window.addEventListener("resize",()=>{C.classList.contains("hidden")||Ut()}),window.capturePhoto=Fe,window.openCamera=ve,window.retakePhoto=Pe,window.switchCamera=Ne,window.confirmSendPhoto=()=>{ye();const l=r.src;l&&ue(l),setTimeout(Pe,300)},window.imageInput=a,a&&a.addEventListener("change",Dt),d&&d.addEventListener("change",Mt),{sendImageMessage:ue,sendDocumentMessage:He,openCamera:ve,closeCameraModal:ye}}function en({appNotification:e,notificationMsg:t,closeNotificationBtn:n}){function s(i,o){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(a=>{a.showNotification(i,{body:o,icon:"/icon.png",tag:`market-${Date.now()}`,renotify:!0,data:{url:"https://www.tradingview.com/"}})})}return e&&e.addEventListener("click",i=>{if(i.target.classList.contains("close-notification")){e.classList.add("hidden"),i.stopPropagation();return}window.open("https://www.tradingview.com/","_blank"),e.classList.add("hidden")}),{showSystemNotification:s}}const tn={apiKey:"AIzaSyDupdTnEuyuFOwypK7tqIuCgmU_tHDcYiY",authDomain:"private-dddb2.firebaseapp.com",projectId:"private-dddb2",storageBucket:"private-dddb2.firebasestorage.app",messagingSenderId:"93498096619",appId:"1:93498096619:web:c0ea372d7e6f86170a77ae",measurementId:"G-B5C8C34XT5",databaseURL:"https://private-dddb2-default-rtdb.firebaseio.com"};try{firebase.initializeApp(tn)}catch{console.error("Firebase Init Error: Please replace firebaseConfig with actual values.")}Y.isNativePlatform()&&ee(async()=>{const{PrivacyScreen:e}=await import("./index-AaSTW6Cv.js");return{PrivacyScreen:e}},[]).then(({PrivacyScreen:e})=>{e.enable().catch(()=>{})}).catch(()=>{});const T=firebase.database(),nn=firebase.messaging(),sn="BJ0uCMTncHrN6Way3i8qoagoN71lcE7PrSNl6E2zUJv2Rv8x4WczsSjId7wUVT2qoPbfGbJQmcjmPVA1kiwsTEE",lt=document.getElementById("login-screen"),on=document.getElementById("username-select"),ut=document.getElementById("pin-input"),an=document.getElementById("login-btn"),rn=document.getElementById("login-error"),$e=document.getElementById("chat-screen"),cn=document.getElementById("chat-with-name"),nt=document.getElementById("typing-indicator"),Te=document.getElementById("last-seen"),W=document.getElementById("chat-container"),J=document.getElementById("message-input"),dn=document.getElementById("send-btn"),ln=document.getElementById("msg-sound");document.getElementById("partner-battery");const mt=document.getElementById("image-input"),un=document.getElementById("doc-input");document.getElementById("doc-btn");const fe=document.getElementById("image-modal"),mn=document.getElementById("modal-img"),gn=document.getElementById("close-modal"),_e=document.getElementById("reply-preview"),fn=document.getElementById("reply-sender"),hn=document.getElementById("reply-text"),pn=document.getElementById("close-reply"),gt=document.getElementById("options-btn"),he=document.getElementById("options-dropdown"),vn=document.getElementById("clear-chat-btn"),ft=document.getElementById("emoji-btn"),Le=document.getElementById("emoji-picker-container"),yn=document.querySelector("emoji-picker"),wn=document.getElementById("app-notification"),Ln=document.getElementById("notification-msg"),En=document.querySelector(".close-notification"),bn=document.getElementById("search-btn"),Pn=document.getElementById("search-bar-container"),Sn=document.getElementById("search-input"),In=document.getElementById("search-back-btn"),Bn=document.getElementById("search-clear-btn"),Cn=document.getElementById("search-controls"),Tn=document.getElementById("search-counter"),kn=document.getElementById("search-up-btn"),Dn=document.getElementById("search-down-btn"),ke=document.getElementById("chat-header"),De=document.getElementById("header-dnd-icon"),X=document.getElementById("dnd-confirm-modal"),st=document.getElementById("dnd-modal-message"),it=document.getElementById("dnd-modal-cancel"),ot=document.getElementById("dnd-modal-send"),xn=document.getElementById("plus-camera-btn"),ht=document.getElementById("plus-btn"),pt=document.getElementById("plus-menu"),Mn=document.getElementById("plus-doc-btn"),An=document.getElementById("plus-gallery-btn");document.getElementById("plus-drawing-btn");const ne=document.getElementById("plus-sleep-btn"),$n=document.getElementById("plus-secret-btn"),Un=document.getElementById("drawing-modal"),_n=document.getElementById("drawing-canvas"),On=document.getElementById("close-drawing"),Rn=document.getElementById("send-drawing"),jn=document.getElementById("clear-drawing"),qn=document.querySelectorAll(".color-swatch"),Hn=document.getElementById("camera-modal"),Nn=document.getElementById("camera-stream"),Fn=document.getElementById("camera-canvas"),Wn=document.getElementById("close-camera"),zn=document.getElementById("capture-btn"),Kn=document.getElementById("switch-camera"),vt=document.getElementById("camera-preview"),Vn=document.getElementById("camera-controls"),Gn=document.getElementById("preview-controls");document.getElementById("retake-btn");const Xn=document.getElementById("send-photo-btn"),Yn="2009";let M=null,z=null,ie=null;const se=new Set,yt={get currentUser(){return M},set currentUser(e){M=e},get chatPartner(){return z},set chatPartner(e){z=e}},Jn={loginScreen:lt,userSelect:on,pinInput:ut,loginError:rn,chatScreen:$e,chatHeaderName:cn},wt={scheduleScrollToBottom:It,initializeChat:Zn,initializePresence:es,renderMessage:Pt,updateMessageStatus:St,pendingKeys:se},{showSystemNotification:Qn}=en({appNotification:wn,notificationMsg:Ln,closeNotificationBtn:En}),pe=Qt({PIN_CODE:Yn,db:T,messaging:nn,VAPID_KEY:sn,ui:Jn,state:yt,helpers:wt}),xe=localStorage.getItem("savedUser");xe?(console.log("Restoring background notifications for:",xe),pe.setupPlatformPush(xe)):pe.setupPlatformPush(null);an.addEventListener("click",pe.handleLogin);Zt({db:T,state:yt,elements:{imageInput:mt,docInput:un,plusBtn:ht,plusMenu:pt,plusGalleryBtn:An,plusSecretBtn:$n,plusDocBtn:Mn,plusCameraBtn:xn,drawingModal:Un,drawingCanvas:_n,closeDrawingBtn:On,sendDrawingBtn:Rn,clearDrawingBtn:jn,colorSwatches:qn,cameraModal:Hn,cameraStream:Nn,cameraCanvas:Fn,closeCameraBtn:Wn,captureBtn:zn,switchCameraBtn:Kn,cameraPreview:vt,cameraControls:Vn,previewControls:Gn,sendPhotoBtn:Xn},helpers:wt,dndHelper:{checkPartnerDndAndSend:Et},pushHelper:{sendPushToPartner:pe.sendPushToPartner}});dn.addEventListener("click",Oe);let oe=null;it&&it.addEventListener("click",()=>{X.classList.add("hidden"),oe=null});ot&&ot.addEventListener("click",()=>{oe&&(oe({highPriority:!0}),oe=null),X.classList.add("hidden")});X&&X.addEventListener("click",e=>{e.target===X&&(X.classList.add("hidden"),oe=null)});J.addEventListener("input",bt);J.addEventListener("keypress",e=>{e.key==="Enter"&&Oe()});ne&&ne.addEventListener("click",()=>{if(!M)return;const e=T.ref(`status/${M}/dnd`);e.once("value").then(t=>{const n=t.val()===!0;e.set(!n),pt.classList.add("hidden"),ht.classList.remove("active")})});document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&Lt()});Xt.addListener("appStateChange",({isActive:e})=>{e||Lt()});function Lt(){$e.classList.contains("hidden")||(console.log("App Backgrounded: Auto-Locking..."),$e.classList.add("hidden"),lt.classList.remove("hidden"),ut.value="",console.log("Session locked. Re-entry required."))}W.addEventListener("click",e=>{e.target.classList.contains("msg-image")&&(fe.classList.remove("hidden"),mn.src=e.target.src)});gn.addEventListener("click",()=>{fe.classList.add("hidden")});fe.addEventListener("click",e=>{e.target===fe&&fe.classList.add("hidden")});pn.addEventListener("click",Re);gt.addEventListener("click",e=>{e.stopPropagation(),he.classList.toggle("hidden"),Le.classList.add("hidden")});document.addEventListener("click",e=>{!gt.contains(e.target)&&!he.contains(e.target)&&he.classList.add("hidden"),!ft.contains(e.target)&&!Le.contains(e.target)&&Le.classList.add("hidden")});vn.addEventListener("click",Tt);ft.addEventListener("click",e=>{e.stopPropagation(),Le.classList.toggle("hidden"),he.classList.add("hidden")});yn.addEventListener("emoji-click",e=>{J.value+=e.detail.unicode,J.focus()});Yt({searchBtn:bn,searchBarContainer:Pn,searchInput:Sn,searchBackBtn:In,searchClearBtn:Bn,searchControls:Cn,searchCounter:Tn,searchUpBtn:kn,searchDownBtn:Dn,chatContainer:W});window.downloadFile=(e,t)=>{const n=document.createElement("a");n.href=e,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)};function Zn(){const e=T.ref("messages");e.limitToLast(100).on("child_added",n=>{const s=n.val();Pt(s,n.key),s.sender!==M&&!s.seen&&is(n.key),s.sender!==M&&(ln.play().catch(()=>{}),s.seen||document.visibilityState==="hidden"&&Qn("Market opens ‚Ä¶",""))}),e.limitToLast(100).on("child_changed",n=>{const s=n.val(),i=n.key,o=document.getElementById("msg-"+i);if(o&&o.classList.contains("pending")){o.classList.remove("pending");const a=o.querySelector(".timestamp"),p=new Date(s.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});a&&(a.textContent=p);const f=o.querySelector(".img-loading-overlay");f&&f.remove();const u=o.querySelector(".secret-bubble .spinner");u&&u.remove();const c=o.querySelector(".doc-loading-spinner");c&&c.remove();const m=o.querySelector(".status-icon");m&&(m.classList.remove("pending-icon"),m.classList.add(s.seen?"seen":""),m.innerHTML='<svg viewBox="0 0 16 15" width="16" height="15" fill="currentColor"><path d="M15.01 3.316l-.478-.372a.365.365 0 0 0-.51.063L8.666 9.879a.32.32 0 0 1-.484.033L4.023 6.045a.364.364 0 0 0-.513.041l-.383.432a.364.364 0 0 0 .046.513l4.743 4.31a.318.318 0 0 0 .484-.033l6.59-8.498a.363.363 0 0 0-.063-.51l.083.016z"/><path d="M11.383 1.36l-.478-.372a.365.365 0 0 0-.51.063L4.566 8.679a.32.32 0 0 1-.484.033L1.09 5.86a.418.418 0 0 0-.541.036L.141 6.314a.319.319 0 0 0 .032.484l3.52 2.953c.143.14.361.125.473-.018l6.837-7.234a.418.418 0 0 0-.063-.526z"/></svg>');return}if(s.deleted){const a=document.getElementById("msg-"+n.key);if(a){const d=a.querySelector(".msg-text");d&&(d.textContent="üö´ This message was deleted",d.className="msg-text deleted-msg",d.setAttribute("data-original","This message was deleted"));const p=a.querySelector(".msg-image");p&&p.remove();const f=a.querySelector(".document-bubble");f&&f.remove();const u=a.querySelector(".msg-reactions");u&&u.remove();const c=a.cloneNode(!0);a.parentNode.replaceChild(c,a)}}else ds(n.key,s.reactions);se.has(n.key)||St(n.key,s.seen)}),e.on("child_removed",n=>{const s=document.getElementById("msg-"+n.key);s&&s.remove()}),T.ref(`status/${z}`).on("value",n=>{const s=n.val();if(s)if(s.online)Te.textContent="Live";else if(s.lastOnline){const i=new Date(s.lastOnline);Te.textContent=`Closed ${i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}else Te.textContent=""}),T.ref(`status/${z}`).on("value",n=>{const s=n.val();s&&(s.typing?nt.textContent="Signal incoming...":nt.textContent="")})}function es(){const e=T.ref(`status/${M}`),t={online:!1,lastOnline:firebase.database.ServerValue.TIMESTAMP},n={online:!0,lastOnline:firebase.database.ServerValue.TIMESTAMP};T.ref(".info/connected").on("value",s=>{s.val()!==!1&&e.onDisconnect().update(t).then(()=>{e.update(n)})}),e.on("value",s=>{const i=s.val(),o=i&&i.dnd===!0;ts(o)})}function ts(e){!ke||!De||(e?(ke.classList.add("sleep-mode"),De.classList.remove("hidden"),ne&&ne.classList.add("active")):(ke.classList.remove("sleep-mode"),De.classList.add("hidden"),ne&&ne.classList.remove("active")))}function ns(){return z?z.charAt(0).toUpperCase()+z.slice(1):"Partner"}function Et(e){if(!z){e({highPriority:!1});return}T.ref(`status/${z}/dnd`).once("value").then(t=>{if(!(t.val()===!0)){e({highPriority:!1});return}const s=ns();st&&(st.textContent=`${s} is in Do Not Disturb. Send signal anyway?`),oe=()=>e({highPriority:!0}),X&&X.classList.remove("hidden")}).catch(()=>{e({highPriority:!1})})}function Oe(){const e=J.value.trim();e&&Et(t=>ss(e,t))}function ss(e,t={}){const n={sender:M,receiver:z,text:e,timestamp:Date.now(),seen:!1,replyTo:ie||null,highPriority:t.highPriority||!1};T.ref("messages").push(n),It([150,400]),J.value="",ie=null,_e.classList.add("hidden"),setTimeout(()=>J.focus(),50),pe.sendPushToPartner()}let Me;function bt(){T.ref(`status/${M}/typing`).set(!0),Me&&clearTimeout(Me),Me=setTimeout(()=>{T.ref(`status/${M}/typing`).set(!1)},2e3)}function is(e){T.ref(`messages/${e}`).update({seen:!0})}function Pt(e,t){const n=e.sender===M;let s=document.getElementById("msg-"+t);const i=!!s;s||(s=document.createElement("div"),s.id="msg-"+t,s.classList.add("message"),s.classList.add(n?"outgoing":"incoming"),s.setAttribute("data-key",t)),se.has(t)?s.classList.add("pending"):s.classList.remove("pending");const o=new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});let a="";if(e.sender===M)if(se.has(t))a=`<span id="status-${t}" class="status-icon pending-icon">üïí</span>`;else{const u=e.seen?"seen":"";a=`<span id="status-${t}" class="status-icon ${u}">
                <svg viewBox="0 0 16 15" width="16" height="15" fill="currentColor">
                    <path d="M15.01 3.316l-.478-.372a.365.365 0 0 0-.51.063L8.666 9.879a.32.32 0 0 1-.484.033L4.023 6.045a.364.364 0 0 0-.513.041l-.383.432a.364.364 0 0 0 .046.513l4.743 4.31a.318.318 0 0 0 .484-.033l6.59-8.498a.363.363 0 0 0-.063-.51l.083.016z"/>
                    <path d="M11.383 1.36l-.478-.372a.365.365 0 0 0-.51.063L4.566 8.679a.32.32 0 0 1-.484.033L1.09 5.86a.418.418 0 0 0-.541.036L.141 6.314a.319.319 0 0 0 .032.484l3.52 2.953c.143.14.361.125.473-.018l6.837-7.234a.418.418 0 0 0-.063-.526z"/>
                </svg>
            </span>`}let d="";if(e.replyTo&&(d=`
            <div class="reply-quote" data-reply-id="${e.replyTo.id}">
                <div class="reply-quote-sender">${e.replyTo.sender===M?"You":e.replyTo.sender}</div>
                <div class="reply-quote-text">${e.replyTo.text}</div>
            </div>
        `),s.innerHTML=`
        ${d}
        ${(()=>{if(e.deleted)return'<div class="msg-text deleted-msg">üö´ This message was deleted</div>';if(e.file){const u=se.has(t),c=e.file.name&&e.file.name.includes(".")?e.file.name.split(".").pop().toUpperCase():"FILE",m=e.file.size/1024,E=m>=1024?(m/1024).toFixed(1)+" MB":m.toFixed(1)+" KB";return`
                <div class="document-bubble" onclick="downloadFile('${e.file.data}', '${e.file.name}')">
                    <div class="doc-icon">${we(c)}</div>
                    <div class="doc-info">
                        <span class="doc-name">${we(e.file.name)}</span>
                        <span class="doc-meta">${E} ‚Ä¢ ${we(c)}</span>
                    </div>
                    ${u?'<div class="doc-loading-spinner" style="margin-left: 5px;">‚è≥</div>':`<div class="doc-download">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                            <path d="M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z"/>
                        </svg>
                    </div>`}
                </div>`}else if(e.image){const u=se.has(t);return e.isSecret?`
                        <div class="secret-bubble" onclick="viewSecretPhoto('${t}', '${e.image}')">
                            <div class="secret-icon">üî•</div>
                            <div class="secret-text">Secret Photo</div>
                            ${u?'<div class="spinner" style="width:15px; height:15px; margin-left:10px;"></div>':""}
                        </div>
                    `:`
                <div style="position:relative; display:inline-block;">
                    <img src="${e.image}" class="msg-image" alt="Image">
                    ${u?'<div class="img-loading-overlay"><div class="spinner"></div></div>':""}
                </div>
                `}else return`<div class="msg-text">${we(e.text)}</div>`})()}
        <div class="msg-meta">
            <span class="timestamp">${o}</span>
            ${a}
        </div>
        <!-- Reactions Container -->
        <div class="msg-reactions ${e.reactions?"":"hidden"}" id="reactions-${t}">
            ${e.reactions?"‚ù§Ô∏è"+(Object.keys(e.reactions).length>1?" "+Object.keys(e.reactions).length:""):""}
        </div>
    `,!i){const u=ct();W.appendChild(s),as(),u&&Ee(!0)}const p=s.querySelector(".msg-text");p&&p.setAttribute("data-original",e.deleted?"This message was deleted":e.text);const f=Y.isNativePlatform();if(i||(f?(e.deleted||dt(s,e,t),rs(s,t,()=>e.reactions),!e.deleted&&e.sender===M&&cs(s,t,e.timestamp)):(s.addEventListener("dblclick",u=>{u.preventDefault(),u.stopPropagation(),e.deleted||Bt(e,t)}),s.addEventListener("click",u=>{u.detail===3&&(u.preventDefault(),u.stopPropagation(),e.deleted||(kt(t,e.reactions),Re()))}),e.deleted||dt(s,e,t),!e.deleted&&e.sender===M&&s.addEventListener("contextmenu",c=>{if(c.preventDefault(),Date.now()-e.timestamp>6e5){alert("You can only delete messages within 10 minutes of sending.");return}confirm("Delete this message for everyone?")&&Ct(t)}))),e.image&&!e.deleted){const u=s.querySelector("img");u&&(u.onload=()=>{ct()&&Ee(!0)})}e.replyTo&&s.querySelector(".reply-quote").addEventListener("click",c=>{c.stopPropagation();const m=e.replyTo.id,E=document.getElementById("msg-"+m);E&&(E.scrollIntoView({behavior:"smooth",block:"center"}),E.classList.add("highlight-message"),setTimeout(()=>{E.classList.remove("highlight-message")},1e3))})}function os(){Y.isNativePlatform(),"getBattery"in navigator&&navigator.getBattery().then(e=>{Ae(e),e.addEventListener("levelchange",()=>Ae(e)),e.addEventListener("chargingchange",()=>Ae(e))})}let at=-1,rt=null;function Ae(e){console.log("Battery Update Triggered",e.level,e.charging);const t=e.level*100,n=e.charging;(Math.abs(t-at)>=1||n!==rt)&&(at=t,rt=n,console.log("Pushing Battery Update to DB:",t,n),T.ref(`status/${M}/battery`).set({level:t,isCharging:n,timestamp:firebase.database.ServerValue.TIMESTAMP}).catch(s=>console.error("Battery DB Error",s)))}os();function St(e,t){const n=document.getElementById(`status-${e}`);n&&(t?n.classList.add("seen"):n.classList.remove("seen"))}function ct(e=80){const{scrollTop:t,scrollHeight:n,clientHeight:s}=W;return n-t-s<=e}function Ee(e=!0){requestAnimationFrame(()=>{requestAnimationFrame(()=>{const t=W.scrollHeight-W.clientHeight;e?W.scrollTo({top:t,behavior:"smooth"}):W.scrollTop=t})})}function It(e=[0,150,400,800]){e.forEach(t=>{t===0?Ee(!1):setTimeout(()=>Ee(!(t<300)),t)})}function as(){const e=Array.from(W.querySelectorAll(".message"));e.forEach((t,n)=>{t.classList.remove("group-start","group-mid","group-end");const s=e[n-1],i=e[n+1],o=t.classList.contains("outgoing"),a=s&&s.classList.contains(o?"outgoing":"incoming"),d=i&&i.classList.contains(o?"outgoing":"incoming");a||t.classList.add("group-start"),d||t.classList.add("group-end"),a&&d&&t.classList.add("group-mid")})}function we(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function rs(e,t,n){let s=0;const i=400;e.addEventListener("touchend",o=>{const a=Date.now();a-s<i?(s=0,o.preventDefault(),kt(t,n?n():null),Re()):s=a},{passive:!1})}function cs(e,t,n){let i;e.addEventListener("touchstart",()=>{i=setTimeout(()=>{if(Date.now()-n>6e5){alert("You can only delete messages within 10 minutes of sending.");return}confirm("Delete this message for everyone?")&&Ct(t)},800)},{passive:!0}),e.addEventListener("touchend",()=>clearTimeout(i),{passive:!0}),e.addEventListener("touchmove",()=>clearTimeout(i),{passive:!0})}function dt(e,t,n){let s=0,i=0;e.addEventListener("touchstart",o=>{s=o.touches[0].clientX,i=s,e.classList.add("swiping")},{passive:!0}),e.addEventListener("touchmove",o=>{i=o.touches[0].clientX;const a=i-s,d=Math.max(0,Math.min(a,120));e.style.transform=`translate3d(${d}px, 0, 0)`},{passive:!0}),e.addEventListener("touchend",()=>{const o=i-s;e.classList.remove("swiping"),o>50&&Bt(t,n),e.style.transform="translate3d(0, 0, 0)",s=0,i=0})}function Bt(e,t){ie={id:t,text:e.image?"üì∑ Photo":e.text,sender:e.sender},fn.textContent=e.sender===M?"You":e.sender,hn.textContent=ie.text,_e.classList.remove("hidden"),J.focus()}function Ct(e){T.ref(`messages/${e}`).update({deleted:!0,text:"üö´ This message was deleted",image:null,file:null}).then(()=>{console.log("Message deleted successfully.")}).catch(t=>{console.error("Error deleting message:",t)})}function Re(){ie=null,_e.classList.add("hidden")}function Tt(){he.classList.add("hidden"),confirm("Are you sure you want to clear this chat? It will be deleted for both sides.")&&T.ref("messages").remove().then(()=>{W.innerHTML=""}).catch(e=>{console.error("Remove failed: "+e.message),alert("Failed to clear chat: "+e.message)})}window.handleTyping=bt;window.handleClearChat=Tt;window.sendMessage=Oe;window.viewSecretPhoto=(e,t)=>{const n=document.getElementById("image-modal"),s=document.getElementById("modal-img");if(!n||!s)return;s.src=t,s.src=t,n.classList.remove("hidden"),n.style.display="flex";let i=document.getElementById("secret-timer-overlay");i||(i=document.createElement("div"),i.id="secret-timer-overlay",i.style.cssText=`
            position: absolute; top: 20px; right: 20px; 
            background: rgba(0,0,0,0.7); color: #ff5252; 
            font-size: 24px; font-weight: bold; 
            padding: 10px 20px; border-radius: 30px;
            pointer-events: none; z-index: 1010;
        `,n.appendChild(i));let o=10;i.textContent=`üî• ${o}s`;const a=setInterval(()=>{o--,i.textContent=`üî• ${o}s`,o<=0&&(clearInterval(a),n.classList.add("hidden"),i.remove(),s.src="",console.log("Self-destructing message:",e),T.ref("messages/"+e).remove())},1e3),d=()=>{clearInterval(a),T.ref("messages/"+e).remove(),i&&i.remove(),n.removeEventListener("click",d)};n.onclick=p=>{(p.target===n||p.target.id==="close-modal")&&(d(),n.classList.add("hidden"))}};window.retakePhoto=retakePhoto;window.switchCamera=switchCamera;window.confirmSendPhoto=function(){window.closeCameraModal();const e=vt.src;e&&sendImageMessage(e),setTimeout(retakePhoto,300)};window.imageInput=mt;function kt(e,t){T.ref(`messages/${e}/reactions/${M}`).transaction(s=>s?null:"‚ù§Ô∏è")}function ds(e,t){const n=document.getElementById(`reactions-${e}`);if(n)if(t){const s=Object.keys(t).length;n.textContent="‚ù§Ô∏è"+(s>1?" "+s:""),n.classList.remove("hidden")}else n.textContent="",n.classList.add("hidden")}export{Ue as W,ee as _,K as r};
