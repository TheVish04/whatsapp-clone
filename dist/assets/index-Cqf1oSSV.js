(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var T;(function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"})(T||(T={}));class z extends Error{constructor(t,n,s){super(t),this.message=t,this.code=n,this.data=s}}const Ae=e=>{var t,n;return e?.androidBridge?"android":!((n=(t=e?.webkit)===null||t===void 0?void 0:t.messageHandlers)===null||n===void 0)&&n.bridge?"ios":"web"},Ue=e=>{const t=e.CapacitorCustomPlatform||null,n=e.Capacitor||{},s=n.Plugins=n.Plugins||{},i=()=>t!==null?t.name:Ae(e),o=()=>i()!=="web",r=c=>{const l=u.get(c);return!!(l?.platforms.has(i())||a(c))},a=c=>{var l;return(l=n.PluginHeaders)===null||l===void 0?void 0:l.find(j=>j.name===c)},d=c=>e.console.error(c),u=new Map,x=(c,l={})=>{const j=u.get(c);if(j)return console.warn(`Capacitor plugin "${c}" already registered. Cannot register plugins twice.`),j.proxy;const E=i(),B=a(c);let w;const xe=async()=>(!w&&E in l?w=typeof l[E]=="function"?w=await l[E]():w=l[E]:t!==null&&!w&&"web"in l&&(w=typeof l.web=="function"?w=await l.web():w=l.web),w),$e=(g,h)=>{var v,b;if(B){const L=B?.methods.find(p=>h===p.name);if(L)return L.rtype==="promise"?p=>n.nativePromise(c,h.toString(),p):(p,R)=>n.nativeCallback(c,h.toString(),p,R);if(g)return(v=g[h])===null||v===void 0?void 0:v.bind(g)}else{if(g)return(b=g[h])===null||b===void 0?void 0:b.bind(g);throw new z(`"${c}" plugin is not implemented on ${E}`,T.Unimplemented)}},N=g=>{let h;const v=(...b)=>{const L=xe().then(p=>{const R=$e(p,g);if(R){const H=R(...b);return h=H?.remove,H}else throw new z(`"${c}.${g}()" is not implemented on ${E}`,T.Unimplemented)});return g==="addListener"&&(L.remove=async()=>h()),L};return v.toString=()=>`${g.toString()}() { [capacitor code] }`,Object.defineProperty(v,"name",{value:g,writable:!1,configurable:!1}),v},te=N("addListener"),ne=N("removeListener"),Oe=(g,h)=>{const v=te({eventName:g},h),b=async()=>{const p=await v;ne({eventName:g,callbackId:p},h)},L=new Promise(p=>v.then(()=>p({remove:b})));return L.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await b()},L},K=new Proxy({},{get(g,h){switch(h){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return B?Oe:te;case"removeListener":return ne;default:return N(h)}}});return s[c]=K,u.set(c,{name:c,proxy:K,platforms:new Set([...Object.keys(l),...B?[E]:[]])}),K};return n.convertFileSrc||(n.convertFileSrc=c=>c),n.getPlatform=i,n.handleError=d,n.isNativePlatform=o,n.isPluginAvailable=r,n.registerPlugin=x,n.Exception=z,n.DEBUG=!!n.DEBUG,n.isLoggingEnabled=!!n.isLoggingEnabled,n},Me=e=>e.Capacitor=Ue(e),q=Me(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),_=q.registerPlugin;class V{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(t,n){let s=!1;this.listeners[t]||(this.listeners[t]=[],s=!0),this.listeners[t].push(n);const o=this.windowListeners[t];o&&!o.registered&&this.addWindowListener(o),s&&this.sendRetainedArgumentsForEvent(t);const r=async()=>this.removeListener(t,n);return Promise.resolve({remove:r})}async removeAllListeners(){this.listeners={};for(const t in this.windowListeners)this.removeWindowListener(this.windowListeners[t]);this.windowListeners={}}notifyListeners(t,n,s){const i=this.listeners[t];if(!i){if(s){let o=this.retainedEventArguments[t];o||(o=[]),o.push(n),this.retainedEventArguments[t]=o}return}i.forEach(o=>o(n))}hasListeners(t){var n;return!!(!((n=this.listeners[t])===null||n===void 0)&&n.length)}registerWindowListener(t,n){this.windowListeners[n]={registered:!1,windowEventName:t,pluginEventName:n,handler:s=>{this.notifyListeners(n,s)}}}unimplemented(t="not implemented"){return new q.Exception(t,T.Unimplemented)}unavailable(t="not available"){return new q.Exception(t,T.Unavailable)}async removeListener(t,n){const s=this.listeners[t];if(!s)return;const i=s.indexOf(n);this.listeners[t].splice(i,1),this.listeners[t].length||this.removeWindowListener(this.windowListeners[t])}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){t&&(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}sendRetainedArgumentsForEvent(t){const n=this.retainedEventArguments[t];n&&(delete this.retainedEventArguments[t],n.forEach(s=>{this.notifyListeners(t,s)}))}}const se=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),ie=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class De extends V{async getCookies(){const t=document.cookie,n={};return t.split(";").forEach(s=>{if(s.length<=0)return;let[i,o]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");i=ie(i).trim(),o=ie(o).trim(),n[i]=o}),n}async setCookie(t){try{const n=se(t.key),s=se(t.value),i=`; expires=${(t.expires||"").replace("expires=","")}`,o=(t.path||"/").replace("path=",""),r=t.url!=null&&t.url.length>0?`domain=${t.url}`:"";document.cookie=`${n}=${s||""}${i}; path=${o}; ${r};`}catch(n){return Promise.reject(n)}}async deleteCookie(t){try{document.cookie=`${t.key}=; Max-Age=0`}catch(n){return Promise.reject(n)}}async clearCookies(){try{const t=document.cookie.split(";")||[];for(const n of t)document.cookie=n.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(t){return Promise.reject(t)}}async clearAllCookies(){try{await this.clearCookies()}catch(t){return Promise.reject(t)}}}_("CapacitorCookies",{web:()=>new De});const je=async e=>new Promise((t,n)=>{const s=new FileReader;s.onload=()=>{const i=s.result;t(i.indexOf(",")>=0?i.split(",")[1]:i)},s.onerror=i=>n(i),s.readAsDataURL(e)}),Re=(e={})=>{const t=Object.keys(e);return Object.keys(e).map(i=>i.toLocaleLowerCase()).reduce((i,o,r)=>(i[o]=e[t[r]],i),{})},He=(e,t=!0)=>e?Object.entries(e).reduce((s,i)=>{const[o,r]=i;let a,d;return Array.isArray(r)?(d="",r.forEach(u=>{a=t?encodeURIComponent(u):u,d+=`${o}=${a}&`}),d.slice(0,-1)):(a=t?encodeURIComponent(r):r,d=`${o}=${a}`),`${s}&${d}`},"").substr(1):null,qe=(e,t={})=>{const n=Object.assign({method:e.method||"GET",headers:e.headers},t),i=Re(e.headers)["content-type"]||"";if(typeof e.data=="string")n.body=e.data;else if(i.includes("application/x-www-form-urlencoded")){const o=new URLSearchParams;for(const[r,a]of Object.entries(e.data||{}))o.set(r,a);n.body=o.toString()}else if(i.includes("multipart/form-data")||e.data instanceof FormData){const o=new FormData;if(e.data instanceof FormData)e.data.forEach((a,d)=>{o.append(d,a)});else for(const a of Object.keys(e.data))o.append(a,e.data[a]);n.body=o;const r=new Headers(n.headers);r.delete("content-type"),n.headers=r}else(i.includes("application/json")||typeof e.data=="object")&&(n.body=JSON.stringify(e.data));return n};class We extends V{async request(t){const n=qe(t,t.webFetchExtra),s=He(t.params,t.shouldEncodeUrlParams),i=s?`${t.url}?${s}`:t.url,o=await fetch(i,n),r=o.headers.get("content-type")||"";let{responseType:a="text"}=o.ok?t:{};r.includes("application/json")&&(a="json");let d,u;switch(a){case"arraybuffer":case"blob":u=await o.blob(),d=await je(u);break;case"json":d=await o.json();break;default:d=await o.text()}const x={};return o.headers.forEach((c,l)=>{x[l]=c}),{data:d,headers:x,status:o.status,url:o.url}}async get(t){return this.request(Object.assign(Object.assign({},t),{method:"GET"}))}async post(t){return this.request(Object.assign(Object.assign({},t),{method:"POST"}))}async put(t){return this.request(Object.assign(Object.assign({},t),{method:"PUT"}))}async patch(t){return this.request(Object.assign(Object.assign({},t),{method:"PATCH"}))}async delete(t){return this.request(Object.assign(Object.assign({},t),{method:"DELETE"}))}}_("CapacitorHttp",{web:()=>new We});var oe;(function(e){e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT"})(oe||(oe={}));var re;(function(e){e.StatusBar="StatusBar",e.NavigationBar="NavigationBar"})(re||(re={}));class _e extends V{async setStyle(){this.unavailable("not available for web")}async setAnimation(){this.unavailable("not available for web")}async show(){this.unavailable("not available for web")}async hide(){this.unavailable("not available for web")}}_("SystemBars",{web:()=>new _e});const P=_("PushNotifications",{}),Fe={apiKey:"AIzaSyDupdTnEuyuFOwypK7tqIuCgmU_tHDcYiY",authDomain:"private-dddb2.firebaseapp.com",projectId:"private-dddb2",storageBucket:"private-dddb2.firebasestorage.app",messagingSenderId:"93498096619",appId:"1:93498096619:web:c0ea372d7e6f86170a77ae",measurementId:"G-B5C8C34XT5",databaseURL:"https://private-dddb2-default-rtdb.firebaseio.com"};try{firebase.initializeApp(Fe)}catch{console.error("Firebase Init Error: Please replace firebaseConfig with actual values.")}const f=firebase.database(),ae=firebase.messaging(),Ne="BJ0uCMTncHrN6Way3i8qoagoN71lcE7PrSNl6E2zUJv2Rv8x4WczsSjId7wUVT2qoPbfGbJQmcjmPVA1kiwsTEE",Ke="2009";let m=null,y=null,A=null;const ze=document.getElementById("login-screen"),Xe=document.getElementById("username-select"),Ge=document.getElementById("pin-input"),Ve=document.getElementById("login-btn"),ce=document.getElementById("login-error"),Je=document.getElementById("chat-screen"),Ye=document.getElementById("chat-with-name"),de=document.getElementById("typing-indicator"),X=document.getElementById("last-seen"),U=document.getElementById("chat-container"),I=document.getElementById("message-input"),Qe=document.getElementById("send-btn"),Ze=document.getElementById("msg-sound"),F=document.getElementById("image-input"),et=document.getElementById("attach-btn"),$=document.getElementById("image-modal"),tt=document.getElementById("modal-img"),nt=document.getElementById("close-modal"),ge=document.getElementById("reply-preview"),st=document.getElementById("reply-sender"),it=document.getElementById("reply-text"),ot=document.getElementById("close-reply"),fe=document.getElementById("options-btn"),M=document.getElementById("options-dropdown"),rt=document.getElementById("clear-chat-btn"),he=document.getElementById("emoji-btn"),W=document.getElementById("emoji-picker-container"),at=document.querySelector("emoji-picker"),G=document.getElementById("app-notification");document.getElementById("notification-msg");document.querySelector(".close-notification");const ct=document.getElementById("camera-btn"),J=document.getElementById("camera-modal"),k=document.getElementById("camera-stream"),S=document.getElementById("camera-canvas"),dt=document.getElementById("close-camera"),lt=document.getElementById("capture-btn"),ut=document.getElementById("switch-camera"),D=document.getElementById("camera-preview"),pe=document.getElementById("camera-controls"),ve=document.getElementById("preview-controls"),mt=document.getElementById("retake-btn"),gt=document.getElementById("send-photo-btn");let C=null,O="user";Ve.addEventListener("click",ye);Qe.addEventListener("click",Y);I.addEventListener("keypress",e=>{e.key==="Enter"&&Y()});I.addEventListener("input",be);et.addEventListener("click",()=>F.click());F.addEventListener("change",Le);U.addEventListener("click",e=>{e.target.classList.contains("msg-image")&&($.classList.remove("hidden"),tt.src=e.target.src)});nt.addEventListener("click",()=>{$.classList.add("hidden")});$.addEventListener("click",e=>{e.target===$&&$.classList.add("hidden")});ot.addEventListener("click",ke);fe.addEventListener("click",e=>{e.stopPropagation(),M.classList.toggle("hidden"),W.classList.add("hidden")});document.addEventListener("click",e=>{!fe.contains(e.target)&&!M.contains(e.target)&&M.classList.add("hidden"),!he.contains(e.target)&&!W.contains(e.target)&&W.classList.add("hidden")});rt.addEventListener("click",Ce);he.addEventListener("click",e=>{e.stopPropagation(),W.classList.toggle("hidden"),M.classList.add("hidden")});at.addEventListener("emoji-click",e=>{I.value+=e.detail.unicode,I.focus()});G.addEventListener("click",e=>{if(e.target.classList.contains("close-notification")){G.classList.add("hidden"),e.stopPropagation();return}window.open("https://www.tradingview.com/","_blank"),G.classList.add("hidden")});ct.addEventListener("click",Ie);dt.addEventListener("click",Z);lt.addEventListener("click",Se);ut.addEventListener("click",Be);mt.addEventListener("click",ee);gt.addEventListener("click",Te);function ye(){const e=Xe.value,t=Ge.value;if(!e){le("Please select a user.");return}if(t!==Ke){le("Incorrect PIN.");return}m=e,y=m==="XAU/USD"?"BTC/USD":"XAU/USD",ze.classList.add("hidden"),Je.classList.remove("hidden"),Ye.textContent=y.charAt(0).toUpperCase()+y.slice(1),vt(),yt(),"Notification"in window?Notification.permission==="default"?Notification.requestPermission().then(function(n){console.log("Notification permission:",n),n==="denied"&&alert("Notifications blocked! Go to browser settings to enable.")}):Notification.permission==="denied"?alert("Notifications are blocked. Please enable in browser Settings > Site Settings > Notifications."):console.log("Notification permission already granted"):console.log("Notifications not supported in this browser"),q.isNativePlatform()?ft():ht()}async function ft(){let e=await P.checkPermissions();if(e.receive==="prompt"&&(e=await P.requestPermissions()),e.receive!=="granted"){console.log("User denied permissions!");return}await P.register(),P.addListener("registration",t=>{console.log("Push Registration Token: ",t.value),we(t.value)}),P.addListener("registrationError",t=>{console.error("Error on registration: ",t)}),P.addListener("pushNotificationReceived",t=>{console.log("Push received: ",t);const{title:n,body:s}=t}),P.addListener("pushNotificationActionPerformed",t=>{console.log("Push action performed: ",t);const n=t.notification.data.url;n&&n.includes("tradingview.com")&&window.open(n,"_system")})}function ht(){if(!("serviceWorker"in navigator)){console.log("Service Worker not supported");return}navigator.serviceWorker.register("./firebase-messaging-sw.js").then(e=>(console.log("Service Worker registered with scope:",e.scope),ae.getToken({vapidKey:Ne,serviceWorkerRegistration:e}))).then(e=>{e?(console.log("FCM Token:",e),we(e)):console.log("No registration token available. Request permission to generate one.")}).catch(e=>{console.log("An error occurred while retrieving token. ",e)}),ae.onMessage(e=>{console.log("Message received. ",e)})}function we(e){let t=localStorage.getItem("deviceId");t||(t="device_"+Math.random().toString(36).substr(2,9),localStorage.setItem("deviceId",t)),f.ref(`tokens/devices/${t}`).set(e),m&&f.ref(`tokens/users/${m}/${t}`).set(e)}async function pt(){if(!y)return;const e=await f.ref(`tokens/users/${y}`).once("value");if(!e.exists())return;const t=e.val();Object.values(t).forEach(s=>{fetch("/api/send-push",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:s,title:"Market opens â€¦",body:""})}).catch(i=>console.error("API Push Error",i))})}function le(e){ce.textContent=e,setTimeout(()=>ce.textContent="",3e3)}function vt(){const e=f.ref("messages");e.limitToLast(100).on("child_added",n=>{const s=n.val();Lt(s,n.key),s.sender!==m&&!s.seen&&wt(n.key),s.sender!==m&&(Ze.play().catch(()=>{}),s.seen||document.visibilityState==="hidden"&&bt("Market opens â€¦",""))}),e.limitToLast(100).on("child_changed",n=>{const s=n.val();Et(n.key,s.seen)}),e.on("child_removed",n=>{const s=document.querySelector(`.message[data-key="${n.key}"]`);s&&s.remove()}),f.ref(`status/${y}/typing`).on("value",n=>{n.val()?de.textContent="typing...":de.textContent=""}),f.ref(`status/${y}`).on("value",n=>{const s=n.val();if(s)if(s.online)X.textContent="Online";else if(s.lastOnline){const i=new Date(s.lastOnline);X.textContent=`Last seen at ${i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}else X.textContent=""})}function yt(){const e=f.ref(`status/${m}`),t={online:!1,lastOnline:firebase.database.ServerValue.TIMESTAMP},n={online:!0,lastOnline:firebase.database.ServerValue.TIMESTAMP};f.ref(".info/connected").on("value",s=>{s.val()!==!1&&e.onDisconnect().update(t).then(()=>{e.update(n)})})}function Y(){const e=I.value.trim();if(!e)return;const t={sender:m,receiver:y,text:e,timestamp:Date.now(),seen:!1,replyTo:A||null};f.ref("messages").push(t),I.value="",ke(),f.ref(`status/${m}/typing`).set(!1),fetch("/api/send-push",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:null})}).catch(s=>console.log("Push send error",s)),pt()}let ue;function be(){f.ref(`status/${m}/typing`).set(!0),clearTimeout(ue),ue=setTimeout(()=>{f.ref(`status/${m}/typing`).set(!1)},2e3)}function Le(e){const t=e.target.files[0];if(!t)return;F.value="";const n=new FileReader;n.onload=s=>{const i=new Image;i.onload=()=>{const o=document.createElement("canvas"),r=600,a=600;let d=i.width,u=i.height;d>u?d>r&&(u*=r/d,d=r):u>a&&(d*=a/u,u=a),o.width=d,o.height=u,o.getContext("2d").drawImage(i,0,0,d,u);const c=o.toDataURL("image/jpeg",.7);Ee(c)},i.src=s.target.result},n.readAsDataURL(t)}function Ee(e){const t={sender:m,receiver:y,text:"ðŸ“· Photo",image:e,timestamp:Date.now(),seen:!1};f.ref("messages").push(t),f.ref(`status/${m}/typing`).set(!1),sendFCMNotification(y,"New Photo from "+m,"ðŸ“· Photo")}function wt(e){f.ref(`messages/${e}`).update({seen:!0})}function bt(e,t){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(n){n.showNotification(e,{body:t,icon:"/icon.png",tag:`market-${Date.now()}`,renotify:!0,data:{url:"https://www.tradingview.com/"}})})}function Lt(e,t){const n=e.sender===m,s=document.createElement("div");s.classList.add("message"),s.classList.add(n?"outgoing":"incoming"),s.setAttribute("data-key",t);const i=new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});let o="";n&&(o=`
            <span class="status-icon ${e.seen?"seen":""}" id="status-${t}">
               <svg viewBox="0 0 16 15" width="16" height="15" fill="currentColor"><path d="M15.01 3.316l-.478-.372a.365.365 0 0 0-.51.063L8.666 9.879a.32.32 0 0 1-.484.033l-.358-.325a.319.319 0 0 0-.484.032l-.378.483a.418.418 0 0 0 .036.541l1.32 1.266c.143.14.361.125.473-.018l5.353-7.771a.418.418 0 0 0-.063-.526z"/><path d="M11.383 1.36l-.478-.372a.365.365 0 0 0-.51.063L4.566 8.679a.32.32 0 0 1-.484.033L1.09 5.86a.418.418 0 0 0-.541.036L.141 6.314a.319.319 0 0 0 .032.484l3.52 2.953c.143.14.361.125.473-.018l6.837-7.234a.418.418 0 0 0-.063-.526z"/></svg>
            </span>
        `);let r="";if(e.replyTo&&(r=`
            <div class="reply-quote">
                <div class="reply-quote-sender">${e.replyTo.sender===m?"You":e.replyTo.sender}</div>
                <div class="reply-quote-text">${e.replyTo.text}</div>
            </div>
        `),s.innerHTML=`
        ${r}
        ${e.image?`<img src="${e.image}" class="msg-image" alt="Image">`:`<div class="msg-text">${Pt(e.text)}</div>`}
        <div class="msg-meta">
            <span class="timestamp">${i}</span>
            ${o}
        </div>
    `,U.appendChild(s),s.addEventListener("dblclick",()=>{Pe(e)}),kt(s,e),e.image){const a=s.querySelector("img");a.onload=me}me()}function Et(e,t){const n=document.getElementById(`status-${e}`);n&&(t?n.classList.add("seen"):n.classList.remove("seen"))}function me(){U.scrollTop=U.scrollHeight}function Pt(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function kt(e,t,n){let s=0,i=0;e.addEventListener("touchstart",o=>{s=o.touches[0].clientX,e.classList.add("swiping")},{passive:!0}),e.addEventListener("touchmove",o=>{i=o.touches[0].clientX;const r=i-s;r>0&&r<100&&(e.style.transform=`translateX(${r}px)`)},{passive:!0}),e.addEventListener("touchend",o=>{e.classList.remove("swiping"),i-s>50&&Pe(t),e.style.transform="translateX(0)",s=0,i=0})}function Pe(e){A={id:"msg-"+Date.now(),text:e.image?"ðŸ“· Photo":e.text,sender:e.sender},st.textContent=e.sender===m?"You":e.sender,it.textContent=A.text,ge.classList.remove("hidden"),I.focus()}function ke(){A=null,ge.classList.add("hidden")}function Ce(){M.classList.add("hidden"),confirm("Are you sure you want to clear this chat? It will be deleted for both sides.")&&f.ref("messages").remove().then(()=>{U.innerHTML=""}).catch(e=>{console.error("Remove failed: "+e.message),alert("Failed to clear chat: "+e.message)})}function Ie(){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert("Camera not supported or permission denied.");return}J.classList.remove("hidden"),Q()}function Q(){C&&C.stop();const e={video:{facingMode:O},audio:!1};navigator.mediaDevices.getUserMedia(e).then(function(t){k.srcObject=t,C=t.getTracks()[0]}).catch(function(t){console.error("Camera Error: "+t),alert("Could not access camera: "+t.message),O==="environment"?(O="user",Q()):J.classList.add("hidden")})}function Be(){O=O==="user"?"environment":"user",Q()}function Z(){J.classList.add("hidden"),C&&(C.stop(),C=null),k.srcObject=null}function Se(){if(!C)return;S.width=k.videoWidth,S.height=k.videoHeight,S.getContext("2d").drawImage(k,0,0,S.width,S.height);const t=S.toDataURL("image/jpeg",.8);D.src=t,k.classList.add("hidden"),D.classList.remove("hidden"),pe.classList.add("hidden"),ve.classList.remove("hidden")}function ee(){D.classList.add("hidden"),k.classList.remove("hidden"),ve.classList.add("hidden"),pe.classList.remove("hidden"),D.src=""}function Te(){const e=D.src;e&&Ee(e),Z(),setTimeout(ee,300)}window.handleLogin=ye;window.handleTyping=be;window.handleImageSelect=Le;window.handleClearChat=Ce;window.sendMessage=Y;window.capturePhoto=Se;window.openCamera=Ie;window.closeCameraModal=Z;window.retakePhoto=ee;window.switchCamera=Be;window.confirmSendPhoto=Te;window.imageInput=F;
