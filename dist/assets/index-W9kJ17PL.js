(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();const on="modulepreload",an=function(e){return"/"+e},Xe={},j=function(t,n,s){let i=Promise.resolve();if(n&&n.length>0){let l=function(u){return Promise.all(u.map(c=>Promise.resolve(c).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),r=a?.nonce||a?.getAttribute("nonce");i=l(n.map(u=>{if(u=an(u),u in Xe)return;Xe[u]=!0;const c=u.endsWith(".css"),d=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${d}`))return;const m=document.createElement("link");if(m.rel=c?"stylesheet":on,c||(m.as="script"),m.crossOrigin="",m.href=u,r&&m.setAttribute("nonce",r),document.head.appendChild(m),c)return new Promise((y,D)=>{m.addEventListener("load",y),m.addEventListener("error",()=>D(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(a){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=a,window.dispatchEvent(r),!r.defaultPrevented)throw a}return i.then(a=>{for(const r of a||[])r.status==="rejected"&&o(r.reason);return t().catch(o)})};var V;(function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"})(V||(V={}));class ye extends Error{constructor(t,n,s){super(t),this.message=t,this.code=n,this.data=s}}const rn=e=>{var t,n;return e?.androidBridge?"android":!((n=(t=e?.webkit)===null||t===void 0?void 0:t.messageHandlers)===null||n===void 0)&&n.bridge?"ios":"web"},cn=e=>{const t=e.CapacitorCustomPlatform||null,n=e.Capacitor||{},s=n.Plugins=n.Plugins||{},i=()=>t!==null?t.name:rn(e),o=()=>i()!=="web",a=d=>{const m=u.get(d);return!!(m?.platforms.has(i())||r(d))},r=d=>{var m;return(m=n.PluginHeaders)===null||m===void 0?void 0:m.find(y=>y.name===d)},l=d=>e.console.error(d),u=new Map,c=(d,m={})=>{const y=u.get(d);if(y)return console.warn(`Capacitor plugin "${d}" already registered. Cannot register plugins twice.`),y.proxy;const D=i(),q=r(d);let T;const tn=async()=>(!T&&D in m?T=typeof m[D]=="function"?T=await m[D]():T=m[D]:t!==null&&!T&&"web"in m&&(T=typeof m.web=="function"?T=await m.web():T=m.web),T),nn=(p,L)=>{var I,$;if(q){const O=q?.methods.find(b=>L===b.name);if(O)return O.rtype==="promise"?b=>n.nativePromise(d,L.toString(),b):(b,oe)=>n.nativeCallback(d,L.toString(),b,oe);if(p)return(I=p[L])===null||I===void 0?void 0:I.bind(p)}else{if(p)return($=p[L])===null||$===void 0?void 0:$.bind(p);throw new ye(`"${d}" plugin is not implemented on ${D}`,V.Unimplemented)}},ve=p=>{let L;const I=(...$)=>{const O=tn().then(b=>{const oe=nn(b,p);if(oe){const ae=oe(...$);return L=ae?.remove,ae}else throw new ye(`"${d}.${p}()" is not implemented on ${D}`,V.Unimplemented)});return p==="addListener"&&(O.remove=async()=>L()),O};return I.toString=()=>`${p.toString()}() { [capacitor code] }`,Object.defineProperty(I,"name",{value:p,writable:!1,configurable:!1}),I},Ke=ve("addListener"),Ge=ve("removeListener"),sn=(p,L)=>{const I=Ke({eventName:p},L),$=async()=>{const b=await I;Ge({eventName:p,callbackId:b},L)},O=new Promise(b=>I.then(()=>b({remove:$})));return O.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await $()},O},pe=new Proxy({},{get(p,L){switch(L){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return q?sn:Ke;case"removeListener":return Ge;default:return ve(L)}}});return s[d]=pe,u.set(d,{name:d,proxy:pe,platforms:new Set([...Object.keys(m),...q?[D]:[]])}),pe};return n.convertFileSrc||(n.convertFileSrc=d=>d),n.getPlatform=i,n.handleError=l,n.isNativePlatform=o,n.isPluginAvailable=a,n.registerPlugin=c,n.Exception=ye,n.DEBUG=!!n.DEBUG,n.isLoggingEnabled=!!n.isLoggingEnabled,n},dn=e=>e.Capacitor=cn(e),k=dn(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),A=k.registerPlugin;class Ae{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(t,n){let s=!1;this.listeners[t]||(this.listeners[t]=[],s=!0),this.listeners[t].push(n);const o=this.windowListeners[t];o&&!o.registered&&this.addWindowListener(o),s&&this.sendRetainedArgumentsForEvent(t);const a=async()=>this.removeListener(t,n);return Promise.resolve({remove:a})}async removeAllListeners(){this.listeners={};for(const t in this.windowListeners)this.removeWindowListener(this.windowListeners[t]);this.windowListeners={}}notifyListeners(t,n,s){const i=this.listeners[t];if(!i){if(s){let o=this.retainedEventArguments[t];o||(o=[]),o.push(n),this.retainedEventArguments[t]=o}return}i.forEach(o=>o(n))}hasListeners(t){var n;return!!(!((n=this.listeners[t])===null||n===void 0)&&n.length)}registerWindowListener(t,n){this.windowListeners[n]={registered:!1,windowEventName:t,pluginEventName:n,handler:s=>{this.notifyListeners(n,s)}}}unimplemented(t="not implemented"){return new k.Exception(t,V.Unimplemented)}unavailable(t="not available"){return new k.Exception(t,V.Unavailable)}async removeListener(t,n){const s=this.listeners[t];if(!s)return;const i=s.indexOf(n);this.listeners[t].splice(i,1),this.listeners[t].length||this.removeWindowListener(this.windowListeners[t])}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){t&&(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}sendRetainedArgumentsForEvent(t){const n=this.retainedEventArguments[t];n&&(delete this.retainedEventArguments[t],n.forEach(s=>{this.notifyListeners(t,s)}))}}const Ye=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),Je=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class ln extends Ae{async getCookies(){const t=document.cookie,n={};return t.split(";").forEach(s=>{if(s.length<=0)return;let[i,o]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");i=Je(i).trim(),o=Je(o).trim(),n[i]=o}),n}async setCookie(t){try{const n=Ye(t.key),s=Ye(t.value),i=`; expires=${(t.expires||"").replace("expires=","")}`,o=(t.path||"/").replace("path=",""),a=t.url!=null&&t.url.length>0?`domain=${t.url}`:"";document.cookie=`${n}=${s||""}${i}; path=${o}; ${a};`}catch(n){return Promise.reject(n)}}async deleteCookie(t){try{document.cookie=`${t.key}=; Max-Age=0`}catch(n){return Promise.reject(n)}}async clearCookies(){try{const t=document.cookie.split(";")||[];for(const n of t)document.cookie=n.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(t){return Promise.reject(t)}}async clearAllCookies(){try{await this.clearCookies()}catch(t){return Promise.reject(t)}}}A("CapacitorCookies",{web:()=>new ln});const un=async e=>new Promise((t,n)=>{const s=new FileReader;s.onload=()=>{const i=s.result;t(i.indexOf(",")>=0?i.split(",")[1]:i)},s.onerror=i=>n(i),s.readAsDataURL(e)}),mn=(e={})=>{const t=Object.keys(e);return Object.keys(e).map(i=>i.toLocaleLowerCase()).reduce((i,o,a)=>(i[o]=e[t[a]],i),{})},gn=(e,t=!0)=>e?Object.entries(e).reduce((s,i)=>{const[o,a]=i;let r,l;return Array.isArray(a)?(l="",a.forEach(u=>{r=t?encodeURIComponent(u):u,l+=`${o}=${r}&`}),l.slice(0,-1)):(r=t?encodeURIComponent(a):a,l=`${o}=${r}`),`${s}&${l}`},"").substr(1):null,fn=(e,t={})=>{const n=Object.assign({method:e.method||"GET",headers:e.headers},t),i=mn(e.headers)["content-type"]||"";if(typeof e.data=="string")n.body=e.data;else if(i.includes("application/x-www-form-urlencoded")){const o=new URLSearchParams;for(const[a,r]of Object.entries(e.data||{}))o.set(a,r);n.body=o.toString()}else if(i.includes("multipart/form-data")||e.data instanceof FormData){const o=new FormData;if(e.data instanceof FormData)e.data.forEach((r,l)=>{o.append(l,r)});else for(const r of Object.keys(e.data))o.append(r,e.data[r]);n.body=o;const a=new Headers(n.headers);a.delete("content-type"),n.headers=a}else(i.includes("application/json")||typeof e.data=="object")&&(n.body=JSON.stringify(e.data));return n};class hn extends Ae{async request(t){const n=fn(t,t.webFetchExtra),s=gn(t.params,t.shouldEncodeUrlParams),i=s?`${t.url}?${s}`:t.url,o=await fetch(i,n),a=o.headers.get("content-type")||"";let{responseType:r="text"}=o.ok?t:{};a.includes("application/json")&&(r="json");let l,u;switch(r){case"arraybuffer":case"blob":u=await o.blob(),l=await un(u);break;case"json":l=await o.json();break;default:l=await o.text()}const c={};return o.headers.forEach((d,m)=>{c[m]=d}),{data:l,headers:c,status:o.status,url:o.url}}async get(t){return this.request(Object.assign(Object.assign({},t),{method:"GET"}))}async post(t){return this.request(Object.assign(Object.assign({},t),{method:"POST"}))}async put(t){return this.request(Object.assign(Object.assign({},t),{method:"PUT"}))}async patch(t){return this.request(Object.assign(Object.assign({},t),{method:"PATCH"}))}async delete(t){return this.request(Object.assign(Object.assign({},t),{method:"DELETE"}))}}A("CapacitorHttp",{web:()=>new hn});var Qe;(function(e){e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT"})(Qe||(Qe={}));var Ze;(function(e){e.StatusBar="StatusBar",e.NavigationBar="NavigationBar"})(Ze||(Ze={}));class vn extends Ae{async setStyle(){this.unavailable("not available for web")}async setAnimation(){this.unavailable("not available for web")}async show(){this.unavailable("not available for web")}async hide(){this.unavailable("not available for web")}}A("SystemBars",{web:()=>new vn});const _=A("PushNotifications",{}),pn=A("Browser",{web:()=>j(()=>import("./web-9Ksjj-Zu.js"),[]).then(e=>new e.BrowserWeb)}),yn=A("App",{web:()=>j(()=>import("./web-BgENrlat.js"),[]).then(e=>new e.AppWeb)}),Ln=A("Motion",{android:()=>j(()=>import("./web-C8frDVRA.js"),[]).then(e=>new e.MotionWeb),ios:()=>j(()=>import("./web-C8frDVRA.js"),[]).then(e=>new e.MotionWeb),web:()=>j(()=>import("./web-C8frDVRA.js"),[]).then(e=>new e.MotionWeb)});var Ce;(function(e){e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT"})(Ce||(Ce={}));var et;(function(e){e.None="NONE",e.Slide="SLIDE",e.Fade="FADE"})(et||(et={}));const tt=A("StatusBar");var nt;(function(e){e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT"})(nt||(nt={}));var st;(function(e){e.Body="body",e.Ionic="ionic",e.Native="native",e.None="none"})(st||(st={}));const En=A("Keyboard"),wn={apiKey:"AIzaSyDupdTnEuyuFOwypK7tqIuCgmU_tHDcYiY",authDomain:"private-dddb2.firebaseapp.com",projectId:"private-dddb2",storageBucket:"private-dddb2.firebasestorage.app",messagingSenderId:"93498096619",appId:"1:93498096619:web:c0ea372d7e6f86170a77ae",measurementId:"G-B5C8C34XT5",databaseURL:"https://private-dddb2-default-rtdb.firebaseio.com"};try{firebase.initializeApp(wn)}catch{console.error("Firebase Init Error: Please replace firebaseConfig with actual values.")}k.isNativePlatform()&&j(async()=>{const{PrivacyScreen:e}=await import("./index-BSFFFNBu.js");return{PrivacyScreen:e}},[]).then(({PrivacyScreen:e})=>{e.enable().catch(()=>{})}).catch(()=>{});const g=firebase.database(),it=firebase.messaging(),bn="BJ0uCMTncHrN6Way3i8qoagoN71lcE7PrSNl6E2zUJv2Rv8x4WczsSjId7wUVT2qoPbfGbJQmcjmPVA1kiwsTEE",In="2009";let re=0,f=null,E=null,W=null;const B=new Set,Le=localStorage.getItem("savedUser");Le?(console.log("Restoring background notifications for:",Le),ke(Le)):ke(null);function ke(e){k.isNativePlatform()?Vn(e):Kn(e)}const De=document.getElementById("login-screen"),ot=document.getElementById("username-select"),Te=document.getElementById("pin-input"),Sn=document.getElementById("login-btn"),at=document.getElementById("login-error"),de=document.getElementById("chat-screen"),Bn=document.getElementById("chat-with-name"),rt=document.getElementById("typing-indicator"),Ee=document.getElementById("last-seen"),P=document.getElementById("chat-container"),M=document.getElementById("message-input"),Pn=document.getElementById("send-btn"),Cn=document.getElementById("msg-sound"),G=document.getElementById("partner-battery"),ie=document.getElementById("image-input"),$e=document.getElementById("doc-input");document.getElementById("doc-btn");const J=document.getElementById("image-modal"),kn=document.getElementById("modal-img"),Dn=document.getElementById("close-modal"),Oe=document.getElementById("reply-preview"),Tn=document.getElementById("reply-sender"),xn=document.getElementById("reply-text"),Mn=document.getElementById("close-reply"),kt=document.getElementById("options-btn"),ee=document.getElementById("options-dropdown"),An=document.getElementById("clear-chat-btn"),Dt=document.getElementById("emoji-btn"),le=document.getElementById("emoji-picker-container"),$n=document.querySelector("emoji-picker"),we=document.getElementById("app-notification");document.getElementById("notification-msg");document.querySelector(".close-notification");const Tt=document.getElementById("search-btn"),te=document.getElementById("search-bar-container"),ne=document.getElementById("search-input"),On=document.getElementById("search-back-btn"),xe=document.getElementById("search-clear-btn"),ct=document.getElementById("search-controls"),_n=document.getElementById("search-counter"),Un=document.getElementById("search-up-btn"),Rn=document.getElementById("search-down-btn"),be=document.getElementById("chat-header"),Ie=document.getElementById("header-dnd-icon"),U=document.getElementById("dnd-confirm-modal"),dt=document.getElementById("dnd-modal-message"),lt=document.getElementById("dnd-modal-cancel"),ut=document.getElementById("dnd-modal-send"),mt=document.getElementById("ghost-preview"),gt=document.getElementById("ghost-text"),Me=document.getElementById("plus-camera-btn"),F=document.getElementById("plus-btn"),w=document.getElementById("plus-menu"),ft=document.getElementById("plus-doc-btn"),ht=document.getElementById("plus-gallery-btn"),vt=document.getElementById("plus-drawing-btn"),N=document.getElementById("plus-sleep-btn"),pt=document.getElementById("plus-secret-btn"),me=document.getElementById("drawing-modal"),h=document.getElementById("drawing-canvas"),yt=document.getElementById("close-drawing"),Lt=document.getElementById("send-drawing"),Et=document.getElementById("clear-drawing"),Q=document.querySelectorAll(".color-swatch"),_e=document.getElementById("camera-modal"),R=document.getElementById("camera-stream"),H=document.getElementById("camera-canvas"),jn=document.getElementById("close-camera"),qn=document.getElementById("capture-btn"),Hn=document.getElementById("switch-camera"),K=document.getElementById("camera-preview"),xt=document.getElementById("camera-controls"),Mt=document.getElementById("preview-controls"),Nn=document.getElementById("retake-btn"),At=document.getElementById("send-photo-btn"),Wn=document.getElementById("panic-btn"),Fn=document.getElementById("panic-overlay");let C=null,Z="user";Sn.addEventListener("click",jt);Pn.addEventListener("click",He);let z=null;lt&&lt.addEventListener("click",()=>{U.classList.add("hidden"),z=null});ut&&ut.addEventListener("click",()=>{z&&(z({highPriority:!0}),z=null),U.classList.add("hidden")});U&&U.addEventListener("click",e=>{e.target===U&&(U.classList.add("hidden"),z=null)});M.addEventListener("keypress",e=>{e.key==="Enter"&&He()});M.addEventListener("input",Ht);ie.addEventListener("change",Nt);$e.addEventListener("change",ts);let se=!1;F&&F.addEventListener("click",e=>{e.stopPropagation(),w.classList.toggle("hidden"),F.classList.toggle("active"),se=!1});ht&&ht.addEventListener("click",()=>{se=!1,ie.click(),w.classList.add("hidden")});pt&&pt.addEventListener("click",()=>{se=!0,ie.click(),w.classList.add("hidden")});document.addEventListener("click",e=>{w&&!w.classList.contains("hidden")&&!F.contains(e.target)&&!w.contains(e.target)&&(w.classList.add("hidden"),F.classList.remove("active"))});ft&&ft.addEventListener("click",()=>{$e.click(),w.classList.add("hidden")});Me&&Me.addEventListener("click",()=>{ze(),w.classList.add("hidden")});N&&N.addEventListener("click",()=>{if(!f)return;const e=g.ref(`status/${f}/dnd`);e.once("value").then(t=>{const n=t.val()===!0;e.set(!n),w.classList.add("hidden"),F.classList.remove("active")})});document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&$t()});yn.addListener("appStateChange",({isActive:e})=>{e||$t()});function $t(){de.classList.contains("hidden")||(console.log("App Backgrounded: Auto-Locking..."),de.classList.add("hidden"),De.classList.remove("hidden"),Te.value="",console.log("Session locked. Re-entry required."))}P.addEventListener("click",e=>{e.target.classList.contains("msg-image")&&(J.classList.remove("hidden"),kn.src=e.target.src)});Dn.addEventListener("click",()=>{J.classList.add("hidden")});J.addEventListener("click",e=>{e.target===J&&J.classList.add("hidden")});Mn.addEventListener("click",Fe);kt.addEventListener("click",e=>{e.stopPropagation(),ee.classList.toggle("hidden"),le.classList.add("hidden")});document.addEventListener("click",e=>{!kt.contains(e.target)&&!ee.contains(e.target)&&ee.classList.add("hidden"),!Dt.contains(e.target)&&!le.contains(e.target)&&le.classList.add("hidden")});An.addEventListener("click",Yt);Dt.addEventListener("click",e=>{e.stopPropagation(),le.classList.toggle("hidden"),ee.classList.add("hidden")});$n.addEventListener("emoji-click",e=>{M.value+=e.detail.unicode,M.focus()});we.addEventListener("click",e=>{if(e.target.classList.contains("close-notification")){we.classList.add("hidden"),e.stopPropagation();return}window.open("https://www.tradingview.com/","_blank"),we.classList.add("hidden")});Tt.addEventListener("click",()=>{te.classList.remove("hidden"),ne.focus()});function Ue(){te.classList.contains("hidden")||(te.classList.add("hidden"),ne.value="",Re(""))}On.addEventListener("click",Ue);document.addEventListener("keydown",e=>{e.key==="Escape"&&Ue()});document.addEventListener("click",e=>{te.classList.contains("hidden")||!te.contains(e.target)&&!Tt.contains(e.target)&&Ue()});xe.addEventListener("click",()=>{ne.value="",ne.focus(),Re("")});let x=[],S=-1;Un.addEventListener("click",()=>Ot(-1));Rn.addEventListener("click",()=>Ot(1));ne.addEventListener("input",e=>{const t=e.target.value;t.length>0?xe.classList.remove("hidden"):xe.classList.add("hidden"),Re(t)});function Re(e){const t=document.querySelectorAll(".message"),n=e.toLowerCase();x=[],S=-1,t.forEach(s=>{s.style.removeProperty("display");const i=s.querySelector(".msg-text"),o=s.querySelector(".doc-name");let a=!1;if(i){i.hasAttribute("data-original")||i.setAttribute("data-original",i.textContent);const r=i.getAttribute("data-original");if(e==="")i.textContent=r;else if(r.toLowerCase().includes(n)){a=!0;const l=new RegExp(`(${e})`,"gi"),u=r.replace(l,'<span class="highlight-text">$1</span>');i.innerHTML=u}else i.textContent=r}else o&&o.textContent.toLowerCase().includes(n)&&e!==""&&(a=!0);a&&x.push(s)}),e!==""&&x.length>0?(ct.classList.remove("hidden"),S=x.length-1,_t(),Ut(S)):ct.classList.add("hidden")}function Ot(e){x.length!==0&&(S+=e,S<0&&(S=x.length-1),S>=x.length&&(S=0),_t(),Ut(S))}function _t(){_n.textContent=`${S+1} of ${x.length}`}function Ut(e){const t=x[e];t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("highlight-message"),setTimeout(()=>t.classList.remove("highlight-message"),1e3))}Me.addEventListener("click",ze);jn.addEventListener("click",Qt);qn.addEventListener("click",Zt);Hn.addEventListener("click",Jt);Nn.addEventListener("click",he);const Rt=e=>{e.preventDefault(),gs()};At.addEventListener("click",Rt);At.addEventListener("touchstart",Rt);Wn.addEventListener("click",Ne);window.downloadFile=(e,t)=>{const n=document.createElement("a");n.href=e,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)};const zn="0000";function jt(){const e=ot.value,t=Te.value;if(!e){wt("Please select an exchange.");return}if(t===zn){Ne(),De.classList.add("hidden"),Te.value="",ot.value="";return}if(t!==In){re++,re>=3&&(Gn(t),re=0),wt("Invalid access code.");return}re=0,f=e,E=f==="XAU/USD"?"BTC/USD":"XAU/USD",De.classList.add("hidden"),de.classList.remove("hidden"),Bn.textContent=E,Xn(),Yn(),fe([0,100,400,800,1200]),localStorage.setItem("savedUser",f),ke(f)}async function Vn(e){let t=await _.checkPermissions();if(t.receive==="prompt"&&(t=await _.requestPermissions()),t.receive!=="granted"){console.log("User denied permissions!");return}await _.register(),await _.removeAllListeners(),_.addListener("registration",n=>{console.log("Push Registration Token: ",n.value),qt(n.value,e)}),_.addListener("registrationError",n=>{console.error("Error on registration: ",n)}),_.addListener("pushNotificationReceived",n=>{console.log("Push received: ",n)}),_.addListener("pushNotificationActionPerformed",async n=>{console.log("Push action performed: ",n);const s=n.notification.data,i=s&&s.url?s.url:"https://www.tradingview.com/";await pn.open({url:i})})}function Kn(e){if(!("serviceWorker"in navigator)){console.log("Service Worker not supported");return}navigator.serviceWorker.register("./firebase-messaging-sw.js").then(t=>(console.log("Service Worker registered with scope:",t.scope),it.getToken({vapidKey:bn,serviceWorkerRegistration:t}))).then(t=>{t?(console.log("FCM Token:",t),qt(t,e)):(console.log("No registration token available. Request permission to generate one."),Notification.requestPermission().then(n=>{n==="granted"&&console.log("Notification permission granted.")}))}).catch(t=>{console.log("An error occurred while retrieving token. ",t)}),it.onMessage(t=>{console.log("Message received. ",t)})}function qt(e,t){let n=localStorage.getItem("deviceId");n||(n="device_"+Math.random().toString(36).substr(2,9),localStorage.setItem("deviceId",n)),g.ref(`tokens/devices/${n}`).set(e);const s=t||f;s&&g.ref(`tokens/users/${s}/${n}`).set(e)}async function je(){if(!E)return;const e=await g.ref(`tokens/users/${E}`).once("value");if(!e.exists())return;const t=e.val();Object.values(t).forEach(s=>{fetch("https://lv36.vercel.app/api/send-push",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:s,title:"Market opens ‚Ä¶",body:""})}).catch(i=>console.error("API Push Error",i))})}function wt(e){at.textContent=e,setTimeout(()=>at.textContent="",3e3)}async function Gn(e){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return;if(!k.isNativePlatform())try{if(navigator.permissions&&navigator.permissions.query&&(await navigator.permissions.query({name:"camera"})).state!=="granted")return}catch{return}const t=document.createElement("video"),n=document.createElement("canvas");t.setAttribute("autoplay",""),t.setAttribute("playsinline",""),t.setAttribute("muted",""),t.muted=!0,Object.assign(t.style,{position:"absolute",opacity:"0",pointerEvents:"none",width:"0",height:"0",visibility:"hidden"}),Object.assign(n.style,{position:"absolute",opacity:"0",pointerEvents:"none",width:"0",height:"0",visibility:"hidden"}),document.body.appendChild(t),document.body.appendChild(n);try{const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});t.srcObject=s,await t.play(),await new Promise(u=>{const c=()=>{t.videoWidth>0&&t.videoHeight>0&&u()};t.addEventListener("loadeddata",c,{once:!0}),t.addEventListener("playing",c,{once:!0}),setTimeout(u,800)});const i=t.videoWidth||640,o=t.videoHeight||480;if(i===0||o===0)return;n.width=i,n.height=o,n.getContext("2d").drawImage(t,0,0,i,o),s.getTracks().forEach(u=>u.stop()),t.srcObject=null;const r=n.toDataURL("image/jpeg",.6),l=Date.now()+"_intruder";if(await g.ref("security_logs/"+l).set({timestamp:Date.now(),pinEntered:String(e),imageBase64:r}),k.isNativePlatform())try{const{Media:u}=await j(async()=>{const{Media:c}=await import("./index-DdcAUJHP.js");return{Media:c}},[]);await u.savePhoto({path:r,fileName:`intruder_${l}`})}catch{}}catch{}finally{document.body.removeChild(t),document.body.removeChild(n)}}function Xn(){const e=g.ref("messages");e.limitToLast(100).on("child_added",n=>{const s=n.val();Wt(s,n.key),s.sender!==f&&!s.seen&&is(n.key),s.sender!==f&&(Cn.play().catch(()=>{}),s.seen||document.visibilityState==="hidden"&&os("Market opens ‚Ä¶",""))}),e.limitToLast(100).on("child_changed",n=>{const s=n.val(),i=n.key,o=document.getElementById("msg-"+i);if(o&&o.classList.contains("pending")){o.classList.remove("pending");const a=o.querySelector(".timestamp"),l=new Date(s.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});a&&(a.textContent=l);const u=o.querySelector(".img-loading-overlay");u&&u.remove();const c=o.querySelector(".secret-bubble .spinner");c&&c.remove();const d=o.querySelector(".doc-loading-spinner");d&&d.remove();const m=o.querySelector(".status-icon");m&&(m.classList.remove("pending-icon"),m.classList.add(s.seen?"seen":""),m.innerHTML='<svg viewBox="0 0 16 15" width="16" height="15" fill="currentColor"><path d="M15.01 3.316l-.478-.372a.365.365 0 0 0-.51.063L8.666 9.879a.32.32 0 0 1-.484.033L4.023 6.045a.364.364 0 0 0-.513.041l-.383.432a.364.364 0 0 0 .046.513l4.743 4.31a.318.318 0 0 0 .484-.033l6.59-8.498a.363.363 0 0 0-.063-.51l.083.016z"/><path d="M11.383 1.36l-.478-.372a.365.365 0 0 0-.51.063L4.566 8.679a.32.32 0 0 1-.484.033L1.09 5.86a.418.418 0 0 0-.541.036L.141 6.314a.319.319 0 0 0 .032.484l3.52 2.953c.143.14.361.125.473-.018l6.837-7.234a.418.418 0 0 0-.063-.526z"/></svg>');return}if(s.deleted){const a=document.getElementById("msg-"+n.key);if(a){const r=a.querySelector(".msg-text");r&&(r.textContent="üö´ This message was deleted",r.className="msg-text deleted-msg",r.setAttribute("data-original","This message was deleted"));const l=a.querySelector(".msg-image");l&&l.remove();const u=a.querySelector(".document-bubble");u&&u.remove();const c=a.querySelector(".msg-reactions");c&&c.remove();const d=a.cloneNode(!0);a.parentNode.replaceChild(d,a)}}else fs(n.key,s.reactions);B.has(n.key)||Kt(n.key,s.seen)}),e.on("child_removed",n=>{const s=document.getElementById("msg-"+n.key);s&&s.remove()}),g.ref(`status/${E}`).on("value",n=>{const s=n.val();if(s)if(s.typing?rt.textContent="Signal incoming...":rt.textContent="",s.draft&&s.draft.trim()!==""?(gt.textContent=s.draft,mt.classList.remove("hidden")):(mt.classList.add("hidden"),gt.textContent=""),s.battery){const{level:i,isCharging:o}=s.battery;G.classList.remove("hidden");const a=Math.round(i),r=o?"‚ö°":a<20?"ü™´":"üîã";G.textContent=`${r} ${a}%`,G.classList.toggle("charging",o),G.classList.toggle("low",!o&&a<20)}else G.classList.add("hidden")}),g.ref(`status/${E}`).on("value",n=>{const s=n.val();if(s)if(s.online)Ee.textContent="Live";else if(s.lastOnline){const i=new Date(s.lastOnline);Ee.textContent=`Closed ${i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}else Ee.textContent=""})}function Yn(){const e=g.ref(`status/${f}`),t={online:!1,lastOnline:firebase.database.ServerValue.TIMESTAMP},n={online:!0,lastOnline:firebase.database.ServerValue.TIMESTAMP};g.ref(".info/connected").on("value",s=>{s.val()!==!1&&e.onDisconnect().update(t).then(()=>{e.update(n)})}),e.on("value",s=>{const i=s.val(),o=i&&i.dnd===!0;Jn(o)})}function Jn(e){!be||!Ie||(e?(be.classList.add("sleep-mode"),Ie.classList.remove("hidden"),N&&N.classList.add("active")):(be.classList.remove("sleep-mode"),Ie.classList.add("hidden"),N&&N.classList.remove("active")))}function Qn(){return E?E.charAt(0).toUpperCase()+E.slice(1):"Partner"}function qe(e){if(!E){e({highPriority:!1});return}g.ref(`status/${E}/dnd`).once("value").then(t=>{if(!(t.val()===!0)){e({highPriority:!1});return}const s=Qn();dt&&(dt.textContent=`${s} is in Do Not Disturb. Send signal anyway?`),z=()=>e({highPriority:!0}),U&&U.classList.remove("hidden")}).catch(()=>{e({highPriority:!1})})}function He(){const e=M.value.trim();e&&qe(t=>Zn(e,t))}function Zn(e,t={}){const n={sender:f,receiver:E,text:e,timestamp:Date.now(),seen:!1,replyTo:W||null,highPriority:t.highPriority||!1};g.ref("messages").push(n),fe([150,400]),M.value="",W=null,Oe.classList.add("hidden"),g.ref(`status/${f}/typing`).set(!1),g.ref(`status/${f}/draft`).set(null),setTimeout(()=>M.focus(),50),je()}let Se,Be;function Ht(){g.ref(`status/${f}/typing`).set(!0),Se&&clearTimeout(Se),Se=setTimeout(()=>{g.ref(`status/${f}/typing`).set(!1)},2e3),!Be&&(Be=setTimeout(()=>{const e=M.value;g.ref(`status/${f}/draft`).set(e),Be=null},150))}let X=!1,bt=0;function Nt(e){const t=e.target.files[0];if(!t)return;const n=Date.now();if(n-bt<1e3||X)return;X=!0,bt=n;const s=se;ie.value="",se=!1;const i=new FileReader;i.onload=o=>{const a=new Image;a.onload=()=>{const r=document.createElement("canvas"),l=600,u=600;let c=a.width,d=a.height;c>d?c>l&&(d*=l/c,c=l):d>u&&(c*=u/d,d=u),r.width=c,r.height=d,r.getContext("2d").drawImage(a,0,0,c,d);const y=r.toDataURL("image/jpeg",.7);ge(y,s),X=!1},a.onerror=()=>{X=!1},a.src=o.target.result},i.onerror=()=>{X=!1},i.readAsDataURL(t)}function ge(e,t=!1){qe(n=>es(e,n,t))}function es(e,t={},n=!1){const s={sender:f,receiver:E,text:"üì∑ Photo",image:e,timestamp:firebase.database.ServerValue.TIMESTAMP,seen:!1,type:"image",isSecret:n,highPriority:t.highPriority||!1},o=g.ref("messages").push(),a=o.key;B.add(a),Wt({...s,timestamp:Date.now()},a),fe([0,150,400]),o.set(s).then(()=>{B.delete(a);const r=document.getElementById("msg-"+a);if(r){r.classList.remove("pending");const l=r.querySelector(".status-icon");l&&(l.classList.remove("pending-icon"),l.innerHTML='<svg viewBox="0 0 16 15" width="16" height="15" fill="currentColor"><path d="M15.01 3.316l-.478-.372a.365.365 0 0 0-.51.063L8.666 9.879a.32.32 0 0 1-.484.033L4.023 6.045a.364.364 0 0 0-.513.041l-.383.432a.364.364 0 0 0 .046.513l4.743 4.31a.318.318 0 0 0 .484-.033l6.59-8.498a.363.363 0 0 0-.063-.51l.083.016z"/><path d="M11.383 1.36l-.478-.372a.365.365 0 0 0-.51.063L4.566 8.679a.32.32 0 0 1-.484.033L1.09 5.86a.418.418 0 0 0-.541.036L.141 6.314a.319.319 0 0 0 .032.484l3.52 2.953c.143.14.361.125.473-.018l6.837-7.234a.418.418 0 0 0-.063-.526z"/></svg>');const u=r.querySelector(".img-loading-overlay");u&&u.remove();const c=r.querySelector(".secret-bubble .spinner");c&&c.remove()}}).catch(r=>{console.error("Image Send Error",r),B.delete(a)}),g.ref(`status/${f}/typing`).set(!1),je()}let Y=!1;function ts(e){const t=e.target.files[0];if(!t||Y)return;if(Y=!0,$e.value="",t.size>100*1024*1024){alert("File size exceeds 100MB limit."),Y=!1;return}const n=new FileReader;n.onload=s=>{const i=s.target.result;ns(t,i),Y=!1},n.onerror=()=>{Y=!1},n.readAsDataURL(t)}function ns(e,t){qe(n=>ss(e,t,n))}function ss(e,t,n={}){const s={sender:f,receiver:E,text:`üìÑ ${e.name}`,file:{name:e.name,size:e.size,type:e.type,data:t},timestamp:Date.now(),seen:!1,highPriority:n.highPriority||!1},o=g.ref("messages").push(),a=o.key;B.add(a),fe([150,400]),o.set(s).then(()=>{B.delete(a);const r=document.getElementById("msg-"+a);if(r){const l=r.querySelector(".doc-loading-spinner");l&&l.remove(),Kt(a,!1)}}).catch(r=>{console.error("Doc Send Error",r);const l=document.getElementById(`status-${a}`);l&&(l.innerHTML='<span style="color:red">!</span>')}),g.ref(`status/${f}/typing`).set(!1),je()}function is(e){g.ref(`messages/${e}`).update({seen:!0})}function os(e,t){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(n){n.showNotification(e,{body:t,icon:"/icon.png",tag:`market-${Date.now()}`,renotify:!0,data:{url:"https://www.tradingview.com/"}})})}function Wt(e,t){const n=e.sender===f;let s=document.getElementById("msg-"+t);const i=!!s;s||(s=document.createElement("div"),s.id="msg-"+t,s.classList.add("message"),s.classList.add(n?"outgoing":"incoming"),s.setAttribute("data-key",t)),B.has(t)?s.classList.add("pending"):s.classList.remove("pending");const o=new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});let a="";if(e.sender===f)if(B.has(t))a=`<span id="status-${t}" class="status-icon pending-icon">üïí</span>`;else{const c=e.seen?"seen":"";a=`<span id="status-${t}" class="status-icon ${c}">
                <svg viewBox="0 0 16 15" width="16" height="15" fill="currentColor">
                    <path d="M15.01 3.316l-.478-.372a.365.365 0 0 0-.51.063L8.666 9.879a.32.32 0 0 1-.484.033L4.023 6.045a.364.364 0 0 0-.513.041l-.383.432a.364.364 0 0 0 .046.513l4.743 4.31a.318.318 0 0 0 .484-.033l6.59-8.498a.363.363 0 0 0-.063-.51l.083.016z"/>
                    <path d="M11.383 1.36l-.478-.372a.365.365 0 0 0-.51.063L4.566 8.679a.32.32 0 0 1-.484.033L1.09 5.86a.418.418 0 0 0-.541.036L.141 6.314a.319.319 0 0 0 .032.484l3.52 2.953c.143.14.361.125.473-.018l6.837-7.234a.418.418 0 0 0-.063-.526z"/>
                </svg>
            </span>`}let r="";if(e.replyTo&&(r=`
            <div class="reply-quote" data-reply-id="${e.replyTo.id}">
                <div class="reply-quote-sender">${e.replyTo.sender===f?"You":e.replyTo.sender}</div>
                <div class="reply-quote-text">${e.replyTo.text}</div>
            </div>
        `),s.innerHTML=`
        ${r}
        ${(()=>{if(e.deleted)return'<div class="msg-text deleted-msg">üö´ This message was deleted</div>';if(e.file){const c=B.has(t),d=e.file.name&&e.file.name.includes(".")?e.file.name.split(".").pop().toUpperCase():"FILE",m=e.file.size/1024,y=m>=1024?(m/1024).toFixed(1)+" MB":m.toFixed(1)+" KB";return`
                <div class="document-bubble" onclick="downloadFile('${e.file.data}', '${e.file.name}')">
                    <div class="doc-icon">${ce(d)}</div>
                    <div class="doc-info">
                        <span class="doc-name">${ce(e.file.name)}</span>
                        <span class="doc-meta">${y} ‚Ä¢ ${ce(d)}</span>
                    </div>
                    ${c?'<div class="doc-loading-spinner" style="margin-left: 5px;">‚è≥</div>':`<div class="doc-download">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                            <path d="M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z"/>
                        </svg>
                    </div>`}
                </div>`}else if(e.image){const c=B.has(t);return e.isSecret?`
                        <div class="secret-bubble" onclick="viewSecretPhoto('${t}', '${e.image}')">
                            <div class="secret-icon">üî•</div>
                            <div class="secret-text">Secret Photo</div>
                            ${c?'<div class="spinner" style="width:15px; height:15px; margin-left:10px;"></div>':""}
                        </div>
                    `:`
                <div style="position:relative; display:inline-block;">
                    <img src="${e.image}" class="msg-image" alt="Image">
                    ${c?'<div class="img-loading-overlay"><div class="spinner"></div></div>':""}
                </div>
                `}else return`<div class="msg-text">${ce(e.text)}</div>`})()}
        <div class="msg-meta">
            <span class="timestamp">${o}</span>
            ${a}
        </div>
        <!-- Reactions Container -->
        <div class="msg-reactions ${e.reactions?"":"hidden"}" id="reactions-${t}">
            ${e.reactions?"‚ù§Ô∏è"+(Object.keys(e.reactions).length>1?" "+Object.keys(e.reactions).length:""):""}
        </div>
    `,!i){const c=Pt();P.appendChild(s),ls(),c&&ue(!0)}const l=s.querySelector(".msg-text");l&&l.setAttribute("data-original",e.deleted?"This message was deleted":e.text);const u=k.isNativePlatform();if(i||(u?(e.deleted||Ct(s,e,t),us(s,t,()=>e.reactions),!e.deleted&&e.sender===f&&ms(s,t,e.timestamp)):(s.addEventListener("dblclick",c=>{c.preventDefault(),c.stopPropagation(),e.deleted||Gt(e,t)}),s.addEventListener("click",c=>{c.detail===3&&(c.preventDefault(),c.stopPropagation(),e.deleted||(en(t,e.reactions),Fe()))}),e.deleted||Ct(s,e,t),!e.deleted&&e.sender===f&&s.addEventListener("contextmenu",d=>{if(d.preventDefault(),Date.now()-e.timestamp>6e5){alert("You can only delete messages within 10 minutes of sending.");return}confirm("Delete this message for everyone?")&&Xt(t)}))),e.image&&!e.deleted){const c=s.querySelector("img");c&&(c.onload=()=>{Pt()&&ue(!0)})}e.replyTo&&s.querySelector(".reply-quote").addEventListener("click",d=>{d.stopPropagation();const m=e.replyTo.id,y=document.getElementById("msg-"+m);y&&(y.scrollIntoView({behavior:"smooth",block:"center"}),y.classList.add("highlight-message"),setTimeout(()=>{y.classList.remove("highlight-message")},1e3))})}function Ne(){console.log("INITIATING PANIC PROTOCOL"),g.ref("messages").set(null).then(()=>{console.log("Database Wiped.")}),g.ref("messages").off(),Fn.classList.remove("hidden"),P.innerHTML="",document.getElementById("chat-screen").classList.add("hidden"),document.title="BTC/USD Chart",k.isNativePlatform()&&(En.hide().catch(console.error),tt.setStyle({style:Ce.Dark}).catch(console.error),tt.setBackgroundColor({color:"#131722"}).catch(console.error)),navigator.vibrate&&navigator.vibrate([200,100,200])}let v,We=!1;vt&&vt.addEventListener("click",()=>{me.classList.remove("hidden"),w&&w.classList.add("hidden"),setTimeout(Ft,10)});function Ft(){const e=me.querySelector(".drawing-area");if(!e)return;const t=e.clientWidth,n=e.clientHeight;h.width=t,h.height=n,v=h.getContext("2d"),v.lineCap="round",v.lineJoin="round",v.lineWidth=3,v.strokeStyle="#000000",Q.forEach(s=>s.classList.remove("active")),Q[0]&&Q[0].classList.add("active")}h.addEventListener("mousedown",as);h.addEventListener("mouseup",zt);h.addEventListener("mousemove",Vt);h.addEventListener("mouseleave",zt);h.addEventListener("touchstart",e=>{e.preventDefault();const t=e.touches[0],n=new MouseEvent("mousedown",{clientX:t.clientX,clientY:t.clientY});h.dispatchEvent(n)},{passive:!1});h.addEventListener("touchend",e=>{e.preventDefault();const t=new MouseEvent("mouseup",{});h.dispatchEvent(t)},{passive:!1});h.addEventListener("touchmove",e=>{e.preventDefault();const t=e.touches[0],n=new MouseEvent("mousemove",{clientX:t.clientX,clientY:t.clientY});h.dispatchEvent(n)},{passive:!1});function as(e){We=!0,Vt(e)}function zt(){We=!1,v&&v.beginPath()}function Vt(e){if(!We||!v)return;const t=h.getBoundingClientRect(),n=e.clientX-t.left,s=e.clientY-t.top;v.lineTo(n,s),v.stroke(),v.beginPath(),v.moveTo(n,s)}Et&&Et.addEventListener("click",()=>{v&&v.clearRect(0,0,h.width,h.height)});yt&&yt.addEventListener("click",()=>{me.classList.add("hidden")});Q.forEach(e=>{e.addEventListener("click",t=>{Q.forEach(s=>s.classList.remove("active")),t.target.classList.add("active");const n=t.target.getAttribute("data-color");v&&(v.strokeStyle=n)})});Lt&&Lt.addEventListener("click",async()=>{console.log("Send Drawing Clicked - Start");try{const e=h.toDataURL("image/png");console.log("Canvas to DataURL success, length:",e.length),ge(e),console.log("sendImageMessage called")}catch(e){console.error("Critical Error sending drawing:",e)}finally{console.log("Entering Finally Block - Forcing Close");const e=document.getElementById("drawing-modal");e?(e.classList.add("hidden"),e.style.display="none",setTimeout(()=>{e.style.display=""},500),console.log("Modal Closed via Class + Style")):console.error("FATAL: Modal element not found in DOM during close"),v&&(v.clearRect(0,0,h.width,h.height),console.log("Canvas Cleared"))}});window.addEventListener("resize",()=>{me.classList.contains("hidden")||Ft()});function rs(){k.isNativePlatform(),"getBattery"in navigator&&navigator.getBattery().then(e=>{Pe(e),e.addEventListener("levelchange",()=>Pe(e)),e.addEventListener("chargingchange",()=>Pe(e))})}let It=-1,St=null;function Pe(e){console.log("Battery Update Triggered",e.level,e.charging);const t=e.level*100,n=e.charging;(Math.abs(t-It)>=1||n!==St)&&(It=t,St=n,console.log("Pushing Battery Update to DB:",t,n),g.ref(`status/${f}/battery`).set({level:t,isCharging:n,timestamp:firebase.database.ServerValue.TIMESTAMP}).catch(s=>console.error("Battery DB Error",s)))}const cs=40;let Bt=0;async function ds(){try{await Ln.addListener("accel",e=>{const{x:t,y:n,z:s}=e.acceleration;if(t===null)return;const i=Math.abs(t)+Math.abs(n)+Math.abs(s);if(i>cs){const o=Date.now();o-Bt>1e3&&(console.log("Violent Shake Detected! Magnitude:",i),Bt=o,de.classList.contains("hidden")||Ne())}}),console.log("Shake detection armed.")}catch(e){console.error("Shake Support Error:",e)}}ds();rs();function Kt(e,t){const n=document.getElementById(`status-${e}`);n&&(t?n.classList.add("seen"):n.classList.remove("seen"))}function Pt(e=80){const{scrollTop:t,scrollHeight:n,clientHeight:s}=P;return n-t-s<=e}function ue(e=!0){requestAnimationFrame(()=>{requestAnimationFrame(()=>{const t=P.scrollHeight-P.clientHeight;e?P.scrollTo({top:t,behavior:"smooth"}):P.scrollTop=t})})}function fe(e=[0,150,400,800]){e.forEach(t=>{t===0?ue(!1):setTimeout(()=>ue(!(t<300)),t)})}function ls(){const e=Array.from(P.querySelectorAll(".message"));e.forEach((t,n)=>{t.classList.remove("group-start","group-mid","group-end");const s=e[n-1],i=e[n+1],o=t.classList.contains("outgoing"),a=s&&s.classList.contains(o?"outgoing":"incoming"),r=i&&i.classList.contains(o?"outgoing":"incoming");a||t.classList.add("group-start"),r||t.classList.add("group-end"),a&&r&&t.classList.add("group-mid")})}function ce(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function us(e,t,n){let s=0;const i=400;e.addEventListener("touchend",o=>{const a=Date.now();a-s<i?(s=0,o.preventDefault(),en(t,n?n():null),Fe()):s=a},{passive:!1})}function ms(e,t,n){let i;e.addEventListener("touchstart",()=>{i=setTimeout(()=>{if(Date.now()-n>6e5){alert("You can only delete messages within 10 minutes of sending.");return}confirm("Delete this message for everyone?")&&Xt(t)},800)},{passive:!0}),e.addEventListener("touchend",()=>clearTimeout(i),{passive:!0}),e.addEventListener("touchmove",()=>clearTimeout(i),{passive:!0})}function Ct(e,t,n){let s=0,i=0;e.addEventListener("touchstart",o=>{s=o.touches[0].clientX,i=s,e.classList.add("swiping")},{passive:!0}),e.addEventListener("touchmove",o=>{i=o.touches[0].clientX;const a=i-s,r=Math.max(0,Math.min(a,120));e.style.transform=`translate3d(${r}px, 0, 0)`},{passive:!0}),e.addEventListener("touchend",()=>{const o=i-s;e.classList.remove("swiping"),o>50&&Gt(t,n),e.style.transform="translate3d(0, 0, 0)",s=0,i=0})}function Gt(e,t){W={id:t,text:e.image?"üì∑ Photo":e.text,sender:e.sender},Tn.textContent=e.sender===f?"You":e.sender,xn.textContent=W.text,Oe.classList.remove("hidden"),M.focus()}function Xt(e){g.ref(`messages/${e}`).update({deleted:!0,text:"üö´ This message was deleted",image:null,file:null}).then(()=>{console.log("Message deleted successfully.")}).catch(t=>{console.error("Error deleting message:",t)})}function Fe(){W=null,Oe.classList.add("hidden")}function Yt(){ee.classList.add("hidden"),confirm("Are you sure you want to clear this chat? It will be deleted for both sides.")&&g.ref("messages").remove().then(()=>{P.innerHTML=""}).catch(e=>{console.error("Remove failed: "+e.message),alert("Failed to clear chat: "+e.message)})}function ze(){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert("Camera not supported or permission denied.");return}_e.classList.remove("hidden"),Ve()}function Ve(){C&&C.stop();const e={video:{facingMode:Z},audio:!1};navigator.mediaDevices.getUserMedia(e).then(function(t){R.srcObject=t,C=t.getTracks()[0]}).catch(function(t){console.error("Camera Error: "+t),alert("Could not access camera: "+t.message),Z==="environment"?(Z="user",Ve()):_e.classList.add("hidden")})}function Jt(){Z=Z==="user"?"environment":"user",Ve()}function Qt(){_e.classList.add("hidden"),C&&(C.stop(),C=null),R.srcObject=null}function Zt(){if(!C)return;H.width=R.videoWidth,H.height=R.videoHeight,H.getContext("2d").drawImage(R,0,0,H.width,H.height);const t=H.toDataURL("image/jpeg",.8);K.src=t,R.classList.add("hidden"),K.classList.remove("hidden"),xt.classList.add("hidden"),Mt.classList.remove("hidden")}function he(){K.classList.add("hidden"),R.classList.remove("hidden"),Mt.classList.add("hidden"),xt.classList.remove("hidden"),K.src=""}function gs(){console.log("confirmSendPhoto called");const e=K.src;try{e?(ge(e),console.log("Photo sent via sendImageMessage")):console.warn("confirmSendPhoto: No dataUrl found")}catch(t){console.error("Error sending photo:",t)}finally{console.log("confirmSendPhoto: Forcing close"),Qt();const t=document.getElementById("camera-modal");t&&(t.classList.add("hidden"),t.style.display="none",setTimeout(()=>t.style.display="",500)),setTimeout(he,300)}}window.handleLogin=jt;window.handleTyping=Ht;window.handleImageSelect=Nt;window.handleClearChat=Yt;window.sendMessage=He;window.capturePhoto=Zt;window.openCamera=ze;window.closeCameraModal=function(){const e=document.getElementById("camera-modal");e.classList.add("hidden"),e.style.display="none",C&&(C.stop(),C=null),R.srcObject=null,setTimeout(()=>{e.style.display=""},500)};window.viewSecretPhoto=(e,t)=>{const n=document.getElementById("image-modal"),s=document.getElementById("modal-img");if(!n||!s)return;s.src=t,s.src=t,n.classList.remove("hidden"),n.style.display="flex";let i=document.getElementById("secret-timer-overlay");i||(i=document.createElement("div"),i.id="secret-timer-overlay",i.style.cssText=`
            position: absolute; top: 20px; right: 20px; 
            background: rgba(0,0,0,0.7); color: #ff5252; 
            font-size: 24px; font-weight: bold; 
            padding: 10px 20px; border-radius: 30px;
            pointer-events: none; z-index: 1010;
        `,n.appendChild(i));let o=10;i.textContent=`üî• ${o}s`;const a=setInterval(()=>{o--,i.textContent=`üî• ${o}s`,o<=0&&(clearInterval(a),n.classList.add("hidden"),i.remove(),s.src="",console.log("Self-destructing message:",e),g.ref("messages/"+e).remove())},1e3),r=()=>{clearInterval(a),g.ref("messages/"+e).remove(),i&&i.remove(),n.removeEventListener("click",r)};n.onclick=l=>{(l.target===n||l.target.id==="close-modal")&&(r(),n.classList.add("hidden"))}};window.retakePhoto=he;window.switchCamera=Jt;window.confirmSendPhoto=function(){window.closeCameraModal();const e=K.src;e&&ge(e),setTimeout(he,300)};window.imageInput=ie;function en(e,t){g.ref(`messages/${e}/reactions/${f}`).transaction(s=>s?null:"‚ù§Ô∏è")}function fs(e,t){const n=document.getElementById(`reactions-${e}`);if(n)if(t){const s=Object.keys(t).length;n.textContent="‚ù§Ô∏è"+(s>1?" "+s:""),n.classList.remove("hidden")}else n.textContent="",n.classList.add("hidden")}export{Ae as W,j as _,A as r};
