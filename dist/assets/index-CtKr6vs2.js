(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();var x;(function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"})(x||(x={}));class V extends Error{constructor(t,n,s){super(t),this.message=t,this.code=n,this.data=s}}const _e=e=>{var t,n;return e?.androidBridge?"android":!((n=(t=e?.webkit)===null||t===void 0?void 0:t.messageHandlers)===null||n===void 0)&&n.bridge?"ios":"web"},qe=e=>{const t=e.CapacitorCustomPlatform||null,n=e.Capacitor||{},s=n.Plugins=n.Plugins||{},o=()=>t!==null?t.name:_e(e),i=()=>o()!=="web",r=d=>{const l=c.get(d);return!!(l?.platforms.has(o())||a(d))},a=d=>{var l;return(l=n.PluginHeaders)===null||l===void 0?void 0:l.find(S=>S.name===d)},u=d=>e.console.error(d),c=new Map,g=(d,l={})=>{const S=c.get(d);if(S)return console.warn(`Capacitor plugin "${d}" already registered. Cannot register plugins twice.`),S.proxy;const E=o(),T=a(d);let L;const je=async()=>(!L&&E in l?L=typeof l[E]=="function"?L=await l[E]():L=l[E]:t!==null&&!L&&"web"in l&&(L=typeof l.web=="function"?L=await l.web():L=l.web),L),Re=(h,p)=>{var w,P;if(T){const k=T?.methods.find(v=>p===v.name);if(k)return k.rtype==="promise"?v=>n.nativePromise(d,p.toString(),v):(v,_)=>n.nativeCallback(d,p.toString(),v,_);if(h)return(w=h[p])===null||w===void 0?void 0:w.bind(h)}else{if(h)return(P=h[p])===null||P===void 0?void 0:P.bind(h);throw new V(`"${d}" plugin is not implemented on ${E}`,x.Unimplemented)}},N=h=>{let p;const w=(...P)=>{const k=je().then(v=>{const _=Re(v,h);if(_){const q=_(...P);return p=q?.remove,q}else throw new V(`"${d}.${h}()" is not implemented on ${E}`,x.Unimplemented)});return h==="addListener"&&(k.remove=async()=>p()),k};return w.toString=()=>`${h.toString()}() { [capacitor code] }`,Object.defineProperty(w,"name",{value:h,writable:!1,configurable:!1}),w},ie=N("addListener"),re=N("removeListener"),He=(h,p)=>{const w=ie({eventName:h},p),P=async()=>{const v=await w;re({eventName:h,callbackId:v},p)},k=new Promise(v=>w.then(()=>v({remove:P})));return k.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await P()},k},K=new Proxy({},{get(h,p){switch(p){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return T?He:ie;case"removeListener":return re;default:return N(p)}}});return s[d]=K,c.set(d,{name:d,proxy:K,platforms:new Set([...Object.keys(l),...T?[E]:[]])}),K};return n.convertFileSrc||(n.convertFileSrc=d=>d),n.getPlatform=o,n.handleError=u,n.isNativePlatform=i,n.isPluginAvailable=r,n.registerPlugin=g,n.Exception=V,n.DEBUG=!!n.DEBUG,n.isLoggingEnabled=!!n.isLoggingEnabled,n},Fe=e=>e.Capacitor=qe(e),F=Fe(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),R=F.registerPlugin;class Q{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(t,n){let s=!1;this.listeners[t]||(this.listeners[t]=[],s=!0),this.listeners[t].push(n);const i=this.windowListeners[t];i&&!i.registered&&this.addWindowListener(i),s&&this.sendRetainedArgumentsForEvent(t);const r=async()=>this.removeListener(t,n);return Promise.resolve({remove:r})}async removeAllListeners(){this.listeners={};for(const t in this.windowListeners)this.removeWindowListener(this.windowListeners[t]);this.windowListeners={}}notifyListeners(t,n,s){const o=this.listeners[t];if(!o){if(s){let i=this.retainedEventArguments[t];i||(i=[]),i.push(n),this.retainedEventArguments[t]=i}return}o.forEach(i=>i(n))}hasListeners(t){var n;return!!(!((n=this.listeners[t])===null||n===void 0)&&n.length)}registerWindowListener(t,n){this.windowListeners[n]={registered:!1,windowEventName:t,pluginEventName:n,handler:s=>{this.notifyListeners(n,s)}}}unimplemented(t="not implemented"){return new F.Exception(t,x.Unimplemented)}unavailable(t="not available"){return new F.Exception(t,x.Unavailable)}async removeListener(t,n){const s=this.listeners[t];if(!s)return;const o=s.indexOf(n);this.listeners[t].splice(o,1),this.listeners[t].length||this.removeWindowListener(this.windowListeners[t])}addWindowListener(t){window.addEventListener(t.windowEventName,t.handler),t.registered=!0}removeWindowListener(t){t&&(window.removeEventListener(t.windowEventName,t.handler),t.registered=!1)}sendRetainedArgumentsForEvent(t){const n=this.retainedEventArguments[t];n&&(delete this.retainedEventArguments[t],n.forEach(s=>{this.notifyListeners(t,s)}))}}const ae=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),ce=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class We extends Q{async getCookies(){const t=document.cookie,n={};return t.split(";").forEach(s=>{if(s.length<=0)return;let[o,i]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");o=ce(o).trim(),i=ce(i).trim(),n[o]=i}),n}async setCookie(t){try{const n=ae(t.key),s=ae(t.value),o=`; expires=${(t.expires||"").replace("expires=","")}`,i=(t.path||"/").replace("path=",""),r=t.url!=null&&t.url.length>0?`domain=${t.url}`:"";document.cookie=`${n}=${s||""}${o}; path=${i}; ${r};`}catch(n){return Promise.reject(n)}}async deleteCookie(t){try{document.cookie=`${t.key}=; Max-Age=0`}catch(n){return Promise.reject(n)}}async clearCookies(){try{const t=document.cookie.split(";")||[];for(const n of t)document.cookie=n.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(t){return Promise.reject(t)}}async clearAllCookies(){try{await this.clearCookies()}catch(t){return Promise.reject(t)}}}R("CapacitorCookies",{web:()=>new We});const ze=async e=>new Promise((t,n)=>{const s=new FileReader;s.onload=()=>{const o=s.result;t(o.indexOf(",")>=0?o.split(",")[1]:o)},s.onerror=o=>n(o),s.readAsDataURL(e)}),Ne=(e={})=>{const t=Object.keys(e);return Object.keys(e).map(o=>o.toLocaleLowerCase()).reduce((o,i,r)=>(o[i]=e[t[r]],o),{})},Ke=(e,t=!0)=>e?Object.entries(e).reduce((s,o)=>{const[i,r]=o;let a,u;return Array.isArray(r)?(u="",r.forEach(c=>{a=t?encodeURIComponent(c):c,u+=`${i}=${a}&`}),u.slice(0,-1)):(a=t?encodeURIComponent(r):r,u=`${i}=${a}`),`${s}&${u}`},"").substr(1):null,Ve=(e,t={})=>{const n=Object.assign({method:e.method||"GET",headers:e.headers},t),o=Ne(e.headers)["content-type"]||"";if(typeof e.data=="string")n.body=e.data;else if(o.includes("application/x-www-form-urlencoded")){const i=new URLSearchParams;for(const[r,a]of Object.entries(e.data||{}))i.set(r,a);n.body=i.toString()}else if(o.includes("multipart/form-data")||e.data instanceof FormData){const i=new FormData;if(e.data instanceof FormData)e.data.forEach((a,u)=>{i.append(u,a)});else for(const a of Object.keys(e.data))i.append(a,e.data[a]);n.body=i;const r=new Headers(n.headers);r.delete("content-type"),n.headers=r}else(o.includes("application/json")||typeof e.data=="object")&&(n.body=JSON.stringify(e.data));return n};class Xe extends Q{async request(t){const n=Ve(t,t.webFetchExtra),s=Ke(t.params,t.shouldEncodeUrlParams),o=s?`${t.url}?${s}`:t.url,i=await fetch(o,n),r=i.headers.get("content-type")||"";let{responseType:a="text"}=i.ok?t:{};r.includes("application/json")&&(a="json");let u,c;switch(a){case"arraybuffer":case"blob":c=await i.blob(),u=await ze(c);break;case"json":u=await i.json();break;default:u=await i.text()}const g={};return i.headers.forEach((d,l)=>{g[l]=d}),{data:u,headers:g,status:i.status,url:i.url}}async get(t){return this.request(Object.assign(Object.assign({},t),{method:"GET"}))}async post(t){return this.request(Object.assign(Object.assign({},t),{method:"POST"}))}async put(t){return this.request(Object.assign(Object.assign({},t),{method:"PUT"}))}async patch(t){return this.request(Object.assign(Object.assign({},t),{method:"PATCH"}))}async delete(t){return this.request(Object.assign(Object.assign({},t),{method:"DELETE"}))}}R("CapacitorHttp",{web:()=>new Xe});var de;(function(e){e.Dark="DARK",e.Light="LIGHT",e.Default="DEFAULT"})(de||(de={}));var le;(function(e){e.StatusBar="StatusBar",e.NavigationBar="NavigationBar"})(le||(le={}));class Ge extends Q{async setStyle(){this.unavailable("not available for web")}async setAnimation(){this.unavailable("not available for web")}async show(){this.unavailable("not available for web")}async hide(){this.unavailable("not available for web")}}R("SystemBars",{web:()=>new Ge});const C=R("PushNotifications",{}),Je="modulepreload",Ye=function(e){return"/"+e},ue={},Qe=function(t,n,s){let o=Promise.resolve();if(n&&n.length>0){let u=function(c){return Promise.all(c.map(g=>Promise.resolve(g).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),a=r?.nonce||r?.getAttribute("nonce");o=u(n.map(c=>{if(c=Ye(c),c in ue)return;ue[c]=!0;const g=c.endsWith(".css"),d=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const l=document.createElement("link");if(l.rel=g?"stylesheet":Je,g||(l.as="script"),l.crossOrigin="",l.href=c,a&&l.setAttribute("nonce",a),document.head.appendChild(l),g)return new Promise((S,E)=>{l.addEventListener("load",S),l.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(r){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=r,window.dispatchEvent(a),!a.defaultPrevented)throw r}return o.then(r=>{for(const a of r||[])a.status==="rejected"&&i(a.reason);return t().catch(i)})},Ze=R("Browser",{web:()=>Qe(()=>import("./web-DqCZfjnq.js"),[]).then(e=>new e.BrowserWeb)}),et={apiKey:"AIzaSyDupdTnEuyuFOwypK7tqIuCgmU_tHDcYiY",authDomain:"private-dddb2.firebaseapp.com",projectId:"private-dddb2",storageBucket:"private-dddb2.firebasestorage.app",messagingSenderId:"93498096619",appId:"1:93498096619:web:c0ea372d7e6f86170a77ae",measurementId:"G-B5C8C34XT5",databaseURL:"https://private-dddb2-default-rtdb.firebaseio.com"};try{firebase.initializeApp(et)}catch{console.error("Firebase Init Error: Please replace firebaseConfig with actual values.")}const f=firebase.database(),me=firebase.messaging(),tt="BJ0uCMTncHrN6Way3i8qoagoN71lcE7PrSNl6E2zUJv2Rv8x4WczsSjId7wUVT2qoPbfGbJQmcjmPVA1kiwsTEE",nt="2009";let m=null,y=null,M=null;const X=localStorage.getItem("savedUser");X?(console.log("Restoring background notifications for:",X),Y(X)):Y(null);function Y(e){F.isNativePlatform()?Pt(e):kt(e)}const st=document.getElementById("login-screen"),ot=document.getElementById("username-select"),it=document.getElementById("pin-input"),rt=document.getElementById("login-btn"),fe=document.getElementById("login-error"),at=document.getElementById("chat-screen"),ct=document.getElementById("chat-with-name"),ge=document.getElementById("typing-indicator"),G=document.getElementById("last-seen"),D=document.getElementById("chat-container"),B=document.getElementById("message-input"),dt=document.getElementById("send-btn"),lt=document.getElementById("msg-sound"),z=document.getElementById("image-input"),Z=document.getElementById("doc-input"),ut=document.getElementById("attach-btn"),mt=document.getElementById("doc-btn"),O=document.getElementById("image-modal"),ft=document.getElementById("modal-img"),gt=document.getElementById("close-modal"),ye=document.getElementById("reply-preview"),ht=document.getElementById("reply-sender"),pt=document.getElementById("reply-text"),vt=document.getElementById("close-reply"),we=document.getElementById("options-btn"),j=document.getElementById("options-dropdown"),yt=document.getElementById("clear-chat-btn"),be=document.getElementById("emoji-btn"),W=document.getElementById("emoji-picker-container"),wt=document.querySelector("emoji-picker"),J=document.getElementById("app-notification");document.getElementById("notification-msg");document.querySelector(".close-notification");const bt=document.getElementById("camera-btn"),ee=document.getElementById("camera-modal"),I=document.getElementById("camera-stream"),$=document.getElementById("camera-canvas"),Et=document.getElementById("close-camera"),Lt=document.getElementById("capture-btn"),Ee=document.getElementById("switch-camera"),U=document.getElementById("camera-preview"),Le=document.getElementById("camera-controls"),Pe=document.getElementById("preview-controls"),ke=document.getElementById("retake-btn"),Ce=document.getElementById("send-photo-btn");let b=null,A="user";rt.addEventListener("click",Be);dt.addEventListener("click",te);B.addEventListener("keypress",e=>{e.key==="Enter"&&te()});B.addEventListener("input",Te);ut.addEventListener("click",()=>z.click());z.addEventListener("change",$e);mt.addEventListener("click",()=>Z.click());Z.addEventListener("change",St);D.addEventListener("click",e=>{e.target.classList.contains("msg-image")&&(O.classList.remove("hidden"),ft.src=e.target.src)});gt.addEventListener("click",()=>{O.classList.add("hidden")});O.addEventListener("click",e=>{e.target===O&&O.classList.add("hidden")});vt.addEventListener("click",Ue);we.addEventListener("click",e=>{e.stopPropagation(),j.classList.toggle("hidden"),W.classList.add("hidden")});document.addEventListener("click",e=>{!we.contains(e.target)&&!j.contains(e.target)&&j.classList.add("hidden"),!be.contains(e.target)&&!W.contains(e.target)&&W.classList.add("hidden")});yt.addEventListener("click",Oe);be.addEventListener("click",e=>{e.stopPropagation(),W.classList.toggle("hidden"),j.classList.add("hidden")});wt.addEventListener("emoji-click",e=>{B.value+=e.detail.unicode,B.focus()});J.addEventListener("click",e=>{if(e.target.classList.contains("close-notification")){J.classList.add("hidden"),e.stopPropagation();return}window.open("https://www.tradingview.com/","_blank"),J.classList.add("hidden")});bt.addEventListener("click",Ae);Et.addEventListener("click",Me);Lt.addEventListener("click",De);Ee.addEventListener("click",oe);ke.addEventListener("click",H);Ee.addEventListener("click",oe);ke.addEventListener("click",H);const Ie=e=>{e.preventDefault(),Dt()};Ce.addEventListener("click",Ie);Ce.addEventListener("touchstart",Ie);window.downloadFile=(e,t)=>{const n=document.createElement("a");n.href=e,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)};function Be(){const e=ot.value,t=it.value;if(!e){he("Please select a user.");return}if(t!==nt){he("Incorrect PIN.");return}m=e,y=m==="XAU/USD"?"BTC/USD":"XAU/USD",st.classList.add("hidden"),at.classList.remove("hidden"),ct.textContent=y.charAt(0).toUpperCase()+y.slice(1),It(),Bt(),localStorage.setItem("savedUser",m),Y(m)}async function Pt(e){let t=await C.checkPermissions();if(t.receive==="prompt"&&(t=await C.requestPermissions()),t.receive!=="granted"){console.log("User denied permissions!");return}await C.register(),await C.removeAllListeners(),C.addListener("registration",n=>{console.log("Push Registration Token: ",n.value),Se(n.value,e)}),C.addListener("registrationError",n=>{console.error("Error on registration: ",n)}),C.addListener("pushNotificationReceived",n=>{console.log("Push received: ",n)}),C.addListener("pushNotificationActionPerformed",async n=>{console.log("Push action performed: ",n);const s=n.notification.data,o=s&&s.url?s.url:"https://www.tradingview.com/";await Ze.open({url:o})})}function kt(e){if(!("serviceWorker"in navigator)){console.log("Service Worker not supported");return}navigator.serviceWorker.register("./firebase-messaging-sw.js").then(t=>(console.log("Service Worker registered with scope:",t.scope),me.getToken({vapidKey:tt,serviceWorkerRegistration:t}))).then(t=>{t?(console.log("FCM Token:",t),Se(t,e)):(console.log("No registration token available. Request permission to generate one."),Notification.requestPermission().then(n=>{n==="granted"&&console.log("Notification permission granted.")}))}).catch(t=>{console.log("An error occurred while retrieving token. ",t)}),me.onMessage(t=>{console.log("Message received. ",t)})}function Se(e,t){let n=localStorage.getItem("deviceId");n||(n="device_"+Math.random().toString(36).substr(2,9),localStorage.setItem("deviceId",n)),f.ref(`tokens/devices/${n}`).set(e);const s=t||m;s&&f.ref(`tokens/users/${s}/${n}`).set(e)}async function Ct(){if(!y)return;const e=await f.ref(`tokens/users/${y}`).once("value");if(!e.exists())return;const t=e.val();Object.values(t).forEach(s=>{fetch("/api/send-push",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:s,title:"Market opens â€¦",body:""})}).catch(o=>console.error("API Push Error",o))})}function he(e){fe.textContent=e,setTimeout(()=>fe.textContent="",3e3)}function It(){const e=f.ref("messages");e.limitToLast(100).on("child_added",n=>{const s=n.val();Ut(s,n.key),s.sender!==m&&!s.seen&&$t(n.key),s.sender!==m&&(lt.play().catch(()=>{}),s.seen||document.visibilityState==="hidden"&&xt("Market opens â€¦",""))}),e.limitToLast(100).on("child_changed",n=>{const s=n.val();Ot(n.key,s.seen)}),e.on("child_removed",n=>{const s=document.querySelector(`.message[data-key="${n.key}"]`);s&&s.remove()}),f.ref(`status/${y}/typing`).on("value",n=>{n.val()?ge.textContent="typing...":ge.textContent=""}),f.ref(`status/${y}`).on("value",n=>{const s=n.val();if(s)if(s.online)G.textContent="Online";else if(s.lastOnline){const o=new Date(s.lastOnline);G.textContent=`Last seen at ${o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}else G.textContent=""})}function Bt(){const e=f.ref(`status/${m}`),t={online:!1,lastOnline:firebase.database.ServerValue.TIMESTAMP},n={online:!0,lastOnline:firebase.database.ServerValue.TIMESTAMP};f.ref(".info/connected").on("value",s=>{s.val()!==!1&&e.onDisconnect().update(t).then(()=>{e.update(n)})})}function te(){const e=B.value.trim();if(!e)return;const t={sender:m,receiver:y,text:e,timestamp:Date.now(),seen:!1,replyTo:M||null};f.ref("messages").push(t),B.value="",Ue(),f.ref(`status/${m}/typing`).set(!1),fetch("/api/send-push",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:null})}).catch(s=>console.log("Push send error",s)),Ct()}let pe;function Te(){f.ref(`status/${m}/typing`).set(!0),clearTimeout(pe),pe=setTimeout(()=>{f.ref(`status/${m}/typing`).set(!1)},2e3)}function $e(e){const t=e.target.files[0];if(!t)return;z.value="";const n=new FileReader;n.onload=s=>{const o=new Image;o.onload=()=>{const i=document.createElement("canvas"),r=600,a=600;let u=o.width,c=o.height;u>c?u>r&&(c*=r/u,u=r):c>a&&(u*=a/c,c=a),i.width=u,i.height=c,i.getContext("2d").drawImage(o,0,0,u,c);const d=i.toDataURL("image/jpeg",.7);ne(d)},o.src=s.target.result},n.readAsDataURL(t)}function ne(e){const t={sender:m,receiver:y,text:"ðŸ“· Photo",image:e,timestamp:Date.now(),seen:!1};f.ref("messages").push(t),f.ref(`status/${m}/typing`).set(!1),sendFCMNotification(y,"New Photo from "+m,"ðŸ“· Photo")}function St(e){const t=e.target.files[0];if(!t)return;if(Z.value="",t.size>100*1024*1024){alert("File size exceeds 100MB limit.");return}const n=new FileReader;n.onload=s=>{const o=s.target.result;Tt(t,o)},n.readAsDataURL(t)}function Tt(e,t){const n={sender:m,receiver:y,text:`ðŸ“„ ${e.name}`,file:{name:e.name,size:e.size,type:e.type,data:t},timestamp:Date.now(),seen:!1};f.ref("messages").push(n),f.ref(`status/${m}/typing`).set(!1)}function $t(e){f.ref(`messages/${e}`).update({seen:!0})}function xt(e,t){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(n){n.showNotification(e,{body:t,icon:"/icon.png",tag:`market-${Date.now()}`,renotify:!0,data:{url:"https://www.tradingview.com/"}})})}function Ut(e,t){const n=e.sender===m,s=document.createElement("div");s.classList.add("message"),s.classList.add(n?"outgoing":"incoming"),s.setAttribute("data-key",t);const o=new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});let i="";n&&(i=`
            <span class="status-icon ${e.seen?"seen":""}" id="status-${t}">
               <svg viewBox="0 0 16 15" width="16" height="15" fill="currentColor"><path d="M15.01 3.316l-.478-.372a.365.365 0 0 0-.51.063L8.666 9.879a.32.32 0 0 1-.484.033l-.358-.325a.319.319 0 0 0-.484.032l-.378.483a.418.418 0 0 0 .036.541l1.32 1.266c.143.14.361.125.473-.018l5.353-7.771a.418.418 0 0 0-.063-.526z"/><path d="M11.383 1.36l-.478-.372a.365.365 0 0 0-.51.063L4.566 8.679a.32.32 0 0 1-.484.033L1.09 5.86a.418.418 0 0 0-.541.036L.141 6.314a.319.319 0 0 0 .032.484l3.52 2.953c.143.14.361.125.473-.018l6.837-7.234a.418.418 0 0 0-.063-.526z"/></svg>
            </span>
        `);let r="";if(e.replyTo&&(r=`
            <div class="reply-quote" data-reply-id="${e.replyTo.id}">
                <div class="reply-quote-sender">${e.replyTo.sender===m?"You":e.replyTo.sender}</div>
                <div class="reply-quote-text">${e.replyTo.text}</div>
            </div>
        `),s.innerHTML=`
        ${r}
        ${e.file?`
                <div class="document-bubble" onclick="downloadFile('${e.file.data}', '${e.file.name}')">
                    <div class="doc-icon">${e.file.name.split(".").pop()}</div>
                    <div class="doc-info">
                        <span class="doc-name">${e.file.name}</span>
                        <span class="doc-meta">${(e.file.size/1024).toFixed(1)} KB â€¢ ${e.file.name.split(".").pop().toUpperCase()}</span>
                    </div>
                    <div class="doc-download">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                            <path d="M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z"/>
                        </svg>
                    </div>
                </div>`:e.image?`<img src="${e.image}" class="msg-image" alt="Image">`:`<div class="msg-text">${At(e.text)}</div>`}
        <div class="msg-meta">
            <span class="timestamp">${o}</span>
            ${i}
        </div>
    `,D.appendChild(s),s.addEventListener("dblclick",()=>{xe(e,t)}),Mt(s,e,t),e.image){const a=s.querySelector("img");a.onload=ve}ve(),e.replyTo&&s.querySelector(".reply-quote").addEventListener("click",u=>{u.stopPropagation();const c=e.replyTo.id,g=document.querySelector(`.message[data-key="${c}"]`);g?(g.scrollIntoView({behavior:"smooth",block:"center"}),g.classList.add("highlight-message"),setTimeout(()=>{g.classList.remove("highlight-message")},1e3)):console.log("Original message not found locally.")})}function Ot(e,t){const n=document.getElementById(`status-${e}`);n&&(t?n.classList.add("seen"):n.classList.remove("seen"))}function ve(){D.scrollTop=D.scrollHeight}function At(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function Mt(e,t,n){let s=0,o=0;e.addEventListener("touchstart",i=>{s=i.touches[0].clientX,e.classList.add("swiping")},{passive:!0}),e.addEventListener("touchmove",i=>{o=i.touches[0].clientX;const r=o-s;r>0&&r<100&&(e.style.transform=`translateX(${r}px)`)},{passive:!0}),e.addEventListener("touchend",i=>{e.classList.remove("swiping"),o-s>50&&xe(t,n),e.style.transform="translateX(0)",s=0,o=0})}function xe(e,t){M={id:t,text:e.image?"ðŸ“· Photo":e.text,sender:e.sender},ht.textContent=e.sender===m?"You":e.sender,pt.textContent=M.text,ye.classList.remove("hidden"),B.focus()}function Ue(){M=null,ye.classList.add("hidden")}function Oe(){j.classList.add("hidden"),confirm("Are you sure you want to clear this chat? It will be deleted for both sides.")&&f.ref("messages").remove().then(()=>{D.innerHTML=""}).catch(e=>{console.error("Remove failed: "+e.message),alert("Failed to clear chat: "+e.message)})}function Ae(){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert("Camera not supported or permission denied.");return}ee.classList.remove("hidden"),se()}function se(){b&&b.stop();const e={video:{facingMode:A},audio:!1};navigator.mediaDevices.getUserMedia(e).then(function(t){I.srcObject=t,b=t.getTracks()[0]}).catch(function(t){console.error("Camera Error: "+t),alert("Could not access camera: "+t.message),A==="environment"?(A="user",se()):ee.classList.add("hidden")})}function oe(){A=A==="user"?"environment":"user",se()}function Me(){ee.classList.add("hidden"),b&&(b.stop(),b=null),I.srcObject=null}function De(){if(!b)return;$.width=I.videoWidth,$.height=I.videoHeight,$.getContext("2d").drawImage(I,0,0,$.width,$.height);const t=$.toDataURL("image/jpeg",.8);U.src=t,I.classList.add("hidden"),U.classList.remove("hidden"),Le.classList.add("hidden"),Pe.classList.remove("hidden")}function H(){U.classList.add("hidden"),I.classList.remove("hidden"),Pe.classList.add("hidden"),Le.classList.remove("hidden"),U.src=""}function Dt(){const e=U.src;e&&ne(e),Me(),setTimeout(H,300)}window.handleLogin=Be;window.handleTyping=Te;window.handleImageSelect=$e;window.handleClearChat=Oe;window.sendMessage=te;window.capturePhoto=De;window.openCamera=Ae;window.closeCameraModal=function(){const e=document.getElementById("camera-modal");e.classList.add("hidden"),e.style.display="none",b&&(b.stop(),b=null),I.srcObject=null,setTimeout(()=>{e.style.display=""},500)};window.retakePhoto=H;window.switchCamera=oe;window.confirmSendPhoto=function(){window.closeCameraModal();const e=U.src;e&&ne(e),setTimeout(H,300)};window.imageInput=z;export{Q as W};
